import{_ as Q}from"./MainWrapperView.vue_vue_type_style_index_0_lang-tVgKb86H.js";import{u as X}from"./theme-DHmr0x84.js";import{_ as W}from"./SelectView.vue_vue_type_style_index_0_lang-CIsCwQDN.js";import{t as Z}from"./trunk-DoavT4Nh.js";import{u as N}from"./http-DVnPWP2w.js";import{i as H}from"./index-CehbAW_K.js";import{h as b}from"./moment-C5S46NFB.js";import{_ as ee}from"./InputView.vue_vue_type_style_index_0_lang-CXScJJ2D.js";import{d as G,N as s,P as Y,Q as j,X as U,R as F,r as z,o as m,c as f,e as t,t as l,a as v,T as p,u as V,w as R,_ as q,b as te,J as $,F as E}from"./index-DG-aKfrZ.js";const ae={class:"dev-wrapper"},oe={class:"device-reading"},se={style:{"margin-top":"1.5rem"},class:"info-sums"},ne={style:{"text-align":"left"}},le={style:{"padding-left":"5px"}},ie={key:0,style:{"text-align":"right"}},re={style:{color:"green","font-weight":"bold"}},ue={key:1,style:{"text-align":"right"}},de={style:{color:"orange","font-weight":"bold"}},ce={key:2,style:{"text-align":"right"}},ve={style:{color:"red","font-weight":"bold"}},pe={style:{"margin-top":"2rem",width:"100%","box-sizing":"border-box"}},me={style:{"margin-top":"2rem",width:"100%","box-sizing":"border-box"}},fe=G({__name:"DeviceInfo",props:{idSpot:{type:Object,required:!0},spotData:{type:Object,required:!0}},setup(M){const i=s(""),h=s(null),I=s(null),D=s(null),u=s(null),d=s({title:{text:"Battery Stats",subtext:"Battery percentage over time",left:"center"},tooltip:{trigger:"axis",axisPointer:{type:"cross"}},legend:{data:["Battery Percentage","Pressure"],bottom:"0"},xAxis:[{type:"category",axisLine:{lineStyle:{color:"#8392A5"}},axisLabel:{interval:60,rotate:45,formatter:function(a){return b(a).format("HH:mm")}},data:[]},{type:"category",axisLine:{lineStyle:{color:"#8392A5"}},axisLabel:{rotate:45,formatter:function(a){}},data:[]}],yAxis:[{name:"Pressure",nameLocation:"middle",nameGap:38,type:"value",position:"left",axisLine:{lineStyle:{color:"#8392A5"}},interval:25,max:300,axisLabel:{formatter:"{value}"}},{name:"Battery Percentage",nameLocation:"middle",nameGap:38,type:"value",position:"right",axisLine:{lineStyle:{color:"#8392A5"}},interval:10,max:100,axisLabel:{formatter:"{value}%"}}],series:[{name:"Pressure",data:[],type:"line",symbol:"none",smooth:!1,yAxisIndex:0,endLabel:{fontSize:9,color:"inherit",show:!0,distance:-50,offset:[0,-20],formatter:function(a){return a.value+" PSI"}}},{name:"Battery Percentage",data:[],type:"line",smooth:!1,symbol:"none",yAxisIndex:1,endLabel:{fontSize:9,color:"inherit",show:!0,distance:-30,offset:[0,-10],distacne:-5,formatter:function(a){return a.value+"%"}},itemStyle:{color:"#f00"}}]}),y=s({title:{text:"Device Response",subtext:"Device response over time (Higher is slower)",left:"center"},tooltip:{trigger:"axis",axisPointer:{type:"cross"}},legend:{data:["Response Time"],bottom:"0"},xAxis:{type:"category",axisLine:{lineStyle:{color:"#8392A5"}},axisLabel:{rotate:45},data:[]},yAxis:{name:"Response Time",nameLocation:"middle",nameGap:38,type:"value",position:"left",axisLine:{lineStyle:{color:"#8392A5"}},interval:25,axisLabel:{formatter:"{value}"}},series:[{name:"Response Time",data:[],type:"line",symbol:"none",smooth:!0,sampling:"average",endLabel:{fontSize:9,color:"inherit",show:!0,distance:0,offset:[0,-10],formatter:function(a){return a.value+" Sec"}}}]}),r=s({}),_=s(null),w=s(null),n=s(20),S=s(2),J=s(8),T=s(!1),P=s({time:[],response:[]}),L=M;Y(()=>{B(),u.value=H(h.value),u.value.setOption(d.value),D.value=H(I.value),D.value.setOption(y.value),i.value=b().format("YYYY-MM-DD")}),window.addEventListener("resize",()=>{u.value&&u.value.resize()}),_.value=setInterval(()=>{B()},S.value*1e3),w.value=setInterval(()=>{O().then(a=>{k(a)}).catch(a=>{console.log(a)})},J.value*1e3);const B=async()=>new Promise(async(a,e)=>{try{const o={id:L.idSpot+""},g=await N().httpPost("api/Device/getdevicedata",o);r.value=g,P.value.time.push(b().format("HH:mm:ss")),P.value.response.push(c().diff),y.value.xAxis.data=P.value.time,y.value.series[0].data=P.value.response,D.value.setOption(y.value)}catch(o){e(o)}}),c=()=>{const a=b(r.value.time);let o=b().diff(a,"seconds");return o<0&&(o=0),o>60?(T.value=!0,{active:o<n.value,diff:Math.floor(o/60),diffType:"minutes"}):o>3600?(T.value=!0,{active:o<n.value,diff:Math.floor(o/3600),diffType:"minutes"}):(T.value=!0,{active:o<n.value,diff:o,diffType:"seconds"})};j(()=>{clearInterval(_.value),clearInterval(w.value),_.value=null,w.value=null}),U(async()=>{u.value&&O().then(a=>{k(a)}).catch(a=>{console.log(a)})});const O=()=>new Promise(async(a,e)=>{try{const o={id:L.idSpot+"",date:i.value},g=await N().httpPost("api/Battery/getstats",o);a(g)}catch(o){e(o)}});F(()=>i.value,()=>{O().then(a=>{k(a)}).catch(a=>{console.log(a)})});const k=a=>{const e=a.battPayload,o=a.pressPayload,A=e.map(x=>x.timestamp),g=e.map(x=>x.batt),C=o.map(x=>x.pressureTime),K=o.map(x=>x.pressure);console.log(C),d.value.xAxis[0].data=C,d.value.xAxis[1].data=A,d.value.series[0].data=K,d.value.series[1].data=g,u.value.setOption(d.value)};return(a,e)=>{const o=z("font-awesome-icon"),A=z("center");return m(),f("div",ae,[t("h5",null,[t("b",null,l(L.spotData.name),1)]),e[13]||(e[13]=t("img",{src:"https://cdn-icons-png.flaticon.com/512/11330/11330463.png",style:{"margin-top":"1rem",width:"150px",height:"150px","object-fit":"cover","border-radius":"100px"}},null,-1)),t("div",oe,[t("div",null,[t("label",null,[v(o,{icon:"gauge"})]),t("span",null,l(r.value.pressure)+" PSI",1)]),t("div",null,[t("label",null,[v(o,{icon:"car-battery"})]),t("span",null,l(r.value.battery)+"%",1)]),t("div",null,[t("label",null,[v(o,{icon:"wifi"})]),t("span",null,l(r.value.signal),1)])]),t("div",se,[t("div",ne,[e[2]||(e[2]=t("label",null,"Last Update ",-1)),t("span",le,[p(l(V(b)(r.value.time).fromNow()),1),e[1]||(e[1]=t("br",null,null,-1)),p(l(V(b)(r.value.time).format("( ddd, DD MMM YY HH:mm:ss )")),1)])]),t("div",null,[c().active&&c().diff<10?(m(),f("div",ie,[v(o,{icon:"circle",style:{color:"green"}}),e[5]||(e[5]=p()),t("span",re,[e[3]||(e[3]=p("Device Active ")),e[4]||(e[4]=t("br",null,null,-1)),p("("+l(c().diff)+" "+l(c().diffType)+" response gap)",1)])])):c().active&&c().diff>=n.value/2?(m(),f("div",ue,[v(o,{icon:"circle",style:{color:"orange"}}),e[8]||(e[8]=p()),t("span",de,[e[6]||(e[6]=p("Device Active ")),e[7]||(e[7]=t("br",null,null,-1)),p("("+l(c().diff)+" "+l(c().diffType)+" response gap - slow)",1)])])):(m(),f("div",ce,[v(o,{icon:"circle",style:{color:"red"}}),e[9]||(e[9]=p()),t("span",ve,"Trouble reading... ("+l(c().diff)+")",1)]))])]),t("div",pe,[e[10]||(e[10]=t("hr",null,null,-1)),v(A,null,{default:R(()=>[v(ee,{"model-value":i.value,"onUpdate:modelValue":e[0]||(e[0]=g=>i.value=g),style:{width:"200px"},"in-label":"Date","in-type":"date"},null,8,["model-value"])]),_:1}),e[11]||(e[11]=t("hr",null,null,-1)),t("div",{ref_key:"batChart",ref:h,style:{width:"100%",height:"500px"}},null,512)]),t("div",me,[e[12]||(e[12]=t("hr",null,null,-1)),t("div",{ref_key:"devResponseChart",ref:I,style:{width:"100%",height:"350px"}},null,512)])])}}}),ye=q(fe,[["__scopeId","data-v-587de952"]]),ge={class:"col-md-3"},xe=["value"],be={class:"device-display"},he=G({__name:"DeviceMonitoring",setup(M){const i=s(null),h=s(!1),I=s(1e3),D=X(),u=s(Z().getAllTrunk()),d=s("trunk1"),y=s(Object.keys(u.value)),r=s([]);return D.asideToggle(!0),Y(()=>{h.value=!0}),F(()=>h.value,_=>{_?(console.log("MONITORING STARTED"),i.value=setInterval(()=>{},I.value)):(console.log("MONITORING STOPPED"),clearInterval(i.value))}),j(()=>{h.value=!1,i.value&&(clearInterval(i.value),i.value=null),console.log("MONITORING STOPPED")}),U(()=>{y.value&&(r.value=u.value[d.value].spot,console.log(r.value))}),(_,w)=>(m(),te(Q,{"context-title":"Device Monitoring"},{default:R(()=>[t("div",ge,[v(W,{"in-label":"Installed Device","model-value":d.value,"onUpdate:modelValue":w[0]||(w[0]=n=>d.value=n)},{default:R(()=>[(m(!0),f(E,null,$(y.value,(n,S)=>(m(),f("option",{key:S,value:n},l(u.value[n].name),9,xe))),128))]),_:1},8,["model-value"])]),t("div",be,[(m(!0),f(E,null,$(r.value,(n,S)=>(m(),f("div",{class:"device-items",key:S},[v(ye,{idSpot:n.id,"spot-data":n},null,8,["idSpot","spot-data"])]))),128))])]),_:1}))}}),Oe=q(he,[["__scopeId","data-v-529d9729"]]);export{Oe as default};
