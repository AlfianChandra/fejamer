import{u as St}from"./theme-BaATEmoT.js";import{_ as Qt}from"./MainWrapperView.vue_vue_type_style_index_0_lang-CjQZoAzi.js";import{_ as xe}from"./SelectView.vue_vue_type_style_index_0_lang-DwUHVLQa.js";import{_ as be}from"./InputView.vue_vue_type_style_index_0_lang-BTKlP1QG.js";import{_ as L}from"./ButtonView.vue_vue_type_style_index_0_computed_true_lang-DpYLILPO.js";import{t as ft}from"./trunk-DoavT4Nh.js";import{d as Ge,h as c,B as Ct,i as mt,E as it,r as Te,o,c as n,a as i,w as C,b as oe,l as P,e as t,F as R,y as K,t as k,p as m,u as w,_ as rt,g as $t,k as W,n as ie,x as Ke,C as We,f as Q,G as Xt,m as Zt}from"./index-CjnCLFck.js";import{a as He}from"./axios-BimPEqV4.js";import{i as el}from"./index-CehbAW_K.js";import{h as F}from"./moment-C5S46NFB.js";import{J as tl,_ as ll,m as al,a as ol,L as sl,u as nl}from"./LoadingView-QaD-Aas2.js";const _t={rf_single:"https://apimljmr.findingoillosses.com/jmr/predict/randfor/single",rf4_multi:"https://apimljmr.findingoillosses.com/jmr/predict/randfor/multi4",dt_single:"https://apimljmr.findingoillosses.com/jmr/predict/dtree/single",dt4_multi:"https://apimljmr.findingoillosses.com/jmr/predict/dtree/multi4",lr_single:"https://apimljmr.findingoillosses.com/jmr/predict/lreg/single"},il=()=>{const le=(r,d)=>{const s=parseFloat(r.lokasi),f=r.status,h=r.titik,O=109.3,E=null;let g="",A,p;return isNaN(s)?(p=!1,A={message:"Probabilitas yang terjadi",probabilities:["Tidak terdapat kebocoran","Start/Stop pompa","Switch tangki"],useMap:!1,leak:!1},{drop:d,suspectLocation:A,tap:p,y:s,status:f,titik:h}):(s<=0?(p=!1,A={message:"Probabilitas yang terjadi",probabilities:["Tidak terdapat kebocoran","Start/Stop pompa","Switch tangki"],useMap:!1,leak:!1}):s>=O?(p=!1,A={message:"Probabilitas yang terjadi",probabilities:["Tidak terdapat kebocoran","Start/Stop pompa","Switch tangki"],useMap:!1,leak:!1}):(p=!0,g=j(s*1e3,tl),A={message:"Terdapat indikasi kebocoran",leak:!0,useMap:!0,leakData:{leak_point:s,pu_location:E,coordinate:g}}),g?{drop:d,suspectLocation:A,tap:p,y:s,mapsLink:g}:{drop:d,suspectLocation:A,tap:p,y:s})},j=(r,d)=>{const h=D(d,r);return{latitude:h[0],longitude:h[1]}},D=(r,d)=>{const s=r.length;for(let f=0;f<s-1;f++){const h=$(r[f][1],r[f][0],r[f+1][1],r[f+1][0]);if(d<=h){const O=N(r[f][1],r[f][0],r[f+1][1],r[f+1][0]);return Y(r[f][1],r[f][0],d,O)}else d-=h}return r[s-1]},N=(r,d,s,f)=>{const h=I=>I*(Math.PI/180),O=I=>I*(180/Math.PI);r=h(r),s=h(s);const E=h(f-d),g=Math.sin(E)*Math.cos(s),A=Math.cos(r)*Math.sin(s)-Math.sin(r)*Math.cos(s)*Math.cos(E),p=Math.atan2(g,A);return(O(p)+360)%360},Y=(r,d,s,f)=>{const O=I=>I*(Math.PI/180),E=I=>I*(180/Math.PI);r=O(r),d=O(d),f=O(f);const g=s/6371e3,A=Math.asin(Math.sin(r)*Math.cos(g)+Math.cos(r)*Math.sin(g)*Math.cos(f)),p=d+Math.atan2(Math.sin(f)*Math.sin(g)*Math.cos(r),Math.cos(g)-Math.sin(r)*Math.sin(A));return[E(A),E(p)]},$=(r,d,s,f)=>{const O=I=>I*(Math.PI/180),E=O(s-r),g=O(f-d),A=Math.sin(E/2)**2+Math.cos(O(r))*Math.cos(O(s))*Math.sin(g/2)**2;return 6371e3*(2*Math.atan2(Math.sqrt(A),Math.sqrt(1-A)))};return{processMap:j,findNewPointOnRoute:D,calculateBearing:N,destinationPoint:Y,haversineDistance:$,processLeakData:le}},rl=()=>({buildDeltas:j=>new Promise((D,N)=>{try{const Y=[],$=[];Object.keys(j).forEach(d=>{if(j[d].type==="normal")for(let s=0;s<j[d].data.length;s++)Y.push(j[d].data[s].yValue);else{const s=[];for(let f=0;f<j[d].data.length;f++)s.push(j[d].data[f].yValue);$.push(s)}});const r=[];for(let d=0;d<$.length;d++){const s=[];for(let f=0;f<4;f++){const h=Math.max(0,Y[f]-$[d][f]).toFixed(2);s.push(h)}r.push(s)}D(r)}catch(Y){N(Y)}})}),ul=()=>({estimateLeak:async(j,D)=>new Promise(async(N,Y)=>{const $=await rl().buildDeltas(j),r=_t[D];let d=1;const s=[];for(let f=0;f<$.length;f++){const h=$[f][0],O=$[f][1],E=$[f][2],g=$[f][3],A=d,p=r==="dynamic"?"dynamic":r,I={spot1:h,spot2:O,spot3:E,spot4:g};p!=="dynamic"?await He.post(p,I).then(V=>{const ge=[],ue=V.data.results;for(const se in ue){const de=il().processLeakData(ue[se],A);ge.push(de)}s.push({model_name:D,estimations:ge,drop:A})}).catch(V=>{console.log(V)}):console.log("DYNAMIC"),d++}N({model:D,data:s,drop_count:$.length})})}),dl=()=>{const le=D=>new Promise(async(N,Y)=>{try{const $=j(D),r=[];if(Object.keys(D).length>0){for(const d in _t)await ul().estimateLeak(D,d).then(s=>{for(const f in s.data)s.data[f].drop===$[f].meta_drop_num&&(s.data[f].drop_metadata={meta_drop_num:$[f].meta_drop_num,meta_drop_date:$[f].meta_date,meta_drop_name:$[f].meta_drop_name,meta_drop_timerange:$[f].meta_time});r.push(s)});N({success:!0,result:r})}else Y({success:!1,message:"No data selected",result:null})}catch($){Y({success:!1,message:$,result:null})}}),j=D=>Object.keys(D).map(Y=>D[Y].type==="drop"?{meta_date:D[Y].date,meta_drop_name:D[Y].name,meta_drop_num:parseInt(D[Y].name.split(" ")[1]),meta_time:D[Y].timerange}:null).filter(Y=>Y!==null);return{startPrediction:le}},pl={style:{width:"100%",display:"flex","flex-flow":"column"}},cl=Ge({__name:"PressureDistView",props:{selectedSpot:{type:String,required:!0},data:{type:Object,required:!0},leakPointResult:Object},setup(le){const j=c(!1),D=le,N=Ct(()=>D.data),Y=c(ft().getAllTrunk()),$=c({}),r=c(D.selectedSpot),d=()=>Y.value[r.value].trunkLength,s=c(0),f=h=>{s.value=h};return mt(()=>{j.value=!0,$.value=N.value,j.value=!1}),it(()=>{j.value=!0,$.value=N.value,j.value=!1}),(h,O)=>{const E=Te("center");return o(),n("div",pl,[i(E,null,{default:C(()=>[i(be,{"in-label":"Drop Tolerance Value","in-type":"number","model-value":s.value,"onUpdate:modelValue":O[0]||(O[0]=g=>s.value=g),style:{width:"200px"}},null,8,["model-value"])]),_:1}),!j.value&&Object.keys($.value).length?(o(),oe(ll,{key:0,onOnToleranceChanged:f,"chart-data":$.value,"selected-spot":r.value,"trunk-length":d(),"tolerance-value":s.value,"prediction-result":D.leakPointResult},null,8,["chart-data","selected-spot","trunk-length","tolerance-value","prediction-result"])):P("",!0)])}}}),vl={class:"bulk-pred-window"},fl={class:"bulk-pred-inner"},ml={class:"table-wrapper"},yl={class:"pred-table"},bl=["rowspan"],gl={style:{"font-size":"12px"}},kl={key:0,style:{"text-align":"left"}},hl={key:0,style:{color:"red"}},wl={key:1,style:{color:"green"}},xl={key:2},Dl={key:1,style:{"font-size":"10px",color:"#aaa"}},Ml=Ge({__name:"BulkPredictionView",props:{predictionData:{type:Array,required:!0}},emits:["close"],setup(le,{emit:j}){const D=j,N=le,Y=()=>{D("close")},$=Ct(()=>{var s,f,h;const r={};for(const O of N.predictionData){const E=O.model,g=O.data||[];for(const A of g){const p=((s=A.drop_metadata)==null?void 0:s.meta_drop_num)??"-",I=((f=A.drop_metadata)==null?void 0:f.meta_drop_date)??"",V=((h=A.drop_metadata)==null?void 0:h.meta_drop_timerange)??"";r[p]||(r[p]={dropNum:p,date:I,timeRange:V,models:[]}),r[p].models.push({model:E,estimations:A.estimations||[]})}}return Object.values(r).sort((O,E)=>parseInt(O.dropNum)-parseInt(E.dropNum))});return(r,d)=>{const s=Te("font-awesome-icon");return o(),n("div",vl,[t("div",fl,[t("button",{class:"bulk-pred-dismiss",onClick:Y},[i(s,{icon:"times"})]),d[14]||(d[14]=t("h2",null,[t("b",null,"Prediction Comparison")],-1)),t("div",ml,[t("table",yl,[t("thead",null,[t("tr",null,[d[0]||(d[0]=t("th",null,"Model",-1)),d[1]||(d[1]=t("th",null,"Drop",-1)),d[2]||(d[2]=t("th",null,"Time Range",-1)),d[3]||(d[3]=t("th",null,"Est #1",-1)),d[4]||(d[4]=t("th",null,"Est #2",-1)),d[5]||(d[5]=t("th",null,"Est #3",-1)),d[6]||(d[6]=t("th",null,"Est #4",-1)),t("th",null,[i(s,{icon:"ellipsis"})])])]),t("tbody",null,[(o(!0),n(R,null,K($.value,(f,h)=>(o(),n(R,{key:h},[(o(!0),n(R,null,K(f.models,(O,E)=>(o(),n("tr",{key:E},[t("td",null,k(O.model.split("_").join(" ").toUpperCase()),1),E===0?(o(),n("td",{key:0,rowspan:f.models.length},[t("b",null,k(f.dropNum),1)],8,bl)):P("",!0),t("td",null,[m(k(w(F)(f.date).format("ddd, DD MMM YYYY"))+" ",1),d[7]||(d[7]=t("br",null,null,-1)),t("b",null,k(f.timeRange),1),d[8]||(d[8]=t("br",null,null,-1)),t("span",gl,k(f.date),1)]),(o(),n(R,null,K(4,g=>{var A,p,I,V;return t("td",{key:g},[O.estimations[g-1]?(o(),n("div",kl,[(A=O.estimations[g-1].suspectLocation)!=null&&A.leak?(o(),n("b",hl,[i(s,{icon:"warning"}),d[9]||(d[9]=m(" Leak Detected "))])):(o(),n("b",wl,[i(s,{icon:"check"}),d[10]||(d[10]=m(" No Leak "))])),d[12]||(d[12]=t("br",null,null,-1)),(p=O.estimations[g-1].suspectLocation)!=null&&p.leak?(o(),n("span",xl,[d[11]||(d[11]=m(" Possible leak: ")),t("b",null," KM "+k(O.estimations[g-1].y??((V=(I=O.estimations[g-1].suspectLocation)==null?void 0:I.leakData)==null?void 0:V.leak_point)??"NaN"),1)])):P("",!0)])):(o(),n("div",Dl," not applicable "))])}),64)),t("td",null,[i(L,{"bt-size":"small","bt-disabled":!1},{default:C(()=>[i(s,{icon:"code-compare"}),d[13]||(d[13]=m(" Compare "))]),_:1})])]))),128))],64))),128))])])])])])}}}),Sl=rt(Ml,[["__scopeId","data-v-234aebae"]]),Cl={key:0,class:"datepickdialog"},$l={class:"datepickinner"},_l={style:{display:"flex","flex-flow":"row nowrap",gap:"0.2rem"}},Pl={key:1,class:"selfnavdialog"},Ol={class:"selfnavdialog-inner"},Yl={style:{display:"flex","flex-flow":"row nowrap","justify-content":"center","margin-bottom":"1rem",gap:"1rem"}},Ll={style:{display:"flex","flex-flow":"row nowrap",gap:"0.5rem","justify-content":"space-between"}},Tl={style:{display:"flex","flex-flow":"row nowrap",gap:"0.3rem"}},El={style:{display:"flex","flex-flow":"row nowrap",gap:"0.3rem",height:"45px","align-items":"center"}},Al={style:{"border-radius":"10px",display:"flex","flex-flow":"row nowrap","justify-content":"space-between","padding-left":"10px","padding-right":"10px",border:"1px solid #ccc",padding:"20px","margin-bottom":"1rem"}},Nl={style:{border:"1px solid #ccc",padding:"5px","padding-left":"70px","text-align":"center","padding-right":"70px","border-radius":"100px"}},Vl={key:0,style:{"font-size":"11px"}},zl={key:0,style:{"font-size":"11px"}},Rl={key:1,style:{"font-size":"11px"}},Fl={style:{display:"flex","flex-flow":"row nowrap",width:"100%","align-items":"center"}},jl={style:{display:"flex","flex-flow":"no wrap",padding:"10px",gap:"0.5rem"}},Il={style:{width:"100%",padding:"10px",position:"relative"}},Ul=["max","value"],Bl={key:0,class:"sel-wrapper"},ql={style:{display:"flex","justify-content":"flex-start","overflow-x":"auto","white-space":"nowrap",padding:"20px",gap:"1rem",width:"40%"}},Kl=["onClick"],Wl={key:0,class:"dataspan"},Hl={style:{width:"50%"}},Gl={style:{color:"#fff",background:"red",width:"70px",padding:"5px","border-radius":"5px","font-size":"10px","text-align":"center"}},Jl={style:{width:"60%","padding-right":"5rem","padding-top":"1rem","padding-bottom":"1rem"}},Ql=["src"],Xl={class:"table-responsive"},Zl={style:{"margin-top":"1rem"}},ea={class:"tbl2"},ta={style:{"margin-top":"1rem"}},la={class:"tbl2"},aa={key:0,style:{color:"red","text-shadow":"0.5px 0.5px 1px rgba(0,0,0,0.6)"}},oa={key:1,style:{color:"orange","text-shadow":"0.5px 0.5px 1px rgba(0,0,0,0.6)"}},sa={key:2,style:{color:"yellow","text-shadow":"0.5px 0.5px 1px rgba(0,0,0,0.6)"}},na={key:3,style:{color:"lime","text-shadow":"0.5px 0.5px 1px rgba(0,0,0,0.6)"}},ia={key:4},ra={key:2,class:"hmloader"},ua={key:3,class:"model-window"},da={class:"modelpick-inner"},pa={key:4,class:"predict-action"},ca={style:{"margin-bottom":"0.1rem"}},va={style:{"margin-bottom":"0.5rem"}},fa={style:{display:"flex","flex-flow":"row nowrap",gap:"0.5rem"}},ma={key:5,class:"leak-window"},ya={style:{color:"rgb(0,150,255)"}},ba={class:"table-responsive"},ga={style:{width:"100%","margin-top":"1rem"},class:"table table-striped table-hover;"},ka={key:0,style:{border:"1px solid #ccc",padding:"10px"}},ha={key:1,style:{border:"1px solid #ccc",padding:"10px"}},wa={style:{"font-weight":"bold",border:"1px solid #ccc",padding:"10px"}},xa={key:0,style:{"font-weight":"bold",border:"1px solid #ccc",padding:"10px"}},Da={key:1,style:{"font-weight":"bold",border:"1px solid #ccc",padding:"10px"}},Ma={key:0},Sa=["href"],Ca={style:{"margin-top":"1rem"}},$a={key:1},_a={style:{"margin-top":"1rem"}},Pa={key:6,class:"setting-window"},Oa={class:"setting-inner"},Ya={class:"pref-block"},La={key:7,class:"save-window"},Ta={class:"save-inner"},Ea={style:{display:"flex","flex-flow":"row nowrap",gap:"0.5rem"}},Aa={key:8,class:"chart-option-window"},Na={class:"chart-option-inner"},Va={type:"button",class:"chart-option-dismiss"},za={key:11,class:"pred-option-window"},Ra={class:"pred-option-inner"},Fa={key:0,style:{"font-size":"12px"}},ja={key:1,style:{"font-size":"12px"}},Ia=Ge({__name:"PlaybackView",props:{initDateFilter:{type:String,required:!0},selectedSpot:{type:String,required:!0},initPlaybackDatas:{type:Array,required:!0},snapShots:{type:Object,required:!1,default:null},mainSize:{type:Object,required:!1},selectedDates:{type:Array,default:null,required:!1}},emits:["onDateChange","onDataSave","onLoadPreset"],setup(le,{emit:j}){const D=dl(),N=nl(),Y=ft(),$=j,r=St(),d=c("forward"),s=c(!1),f=c(""),h=c(!0),O=c(!1),E=c(150),g=le,A=c(),p=c(),I=c(Y.getAllTrunk()),V=c(0),ge=c(0),ue=c([]),se=c(!1),de=c(250);let pe=null;const $e=c(!1);let ce=[];const ve={},ut=c(),_e=c(""),ke=c(""),H=c(!0),ne=c(!1),z=c(!1),De=c(!1),Me=c(!1),he=c(!1),Z=c(7),Pe=$t();c(Pe.params.saveid);let te=c({}),Ee=null;const Ae=c([]),x=c(null),v=c({}),T=()=>{p.value=el(A.value);const a={grid:{top:"10%",left:"10%",right:"10%",bottom:"15%"},legend:{show:!0,type:"scroll",orient:"horizontal"},tooltip:{trigger:"item",triggerOn:"mousemove",axisPointer:{type:"cross",label:{backgroundColor:"#6a7985"}}},axisPointer:{show:!0,type:"shadow"},xAxis:[{type:"category",data:[],boundaryGap:!1,splitNumber:1,minInterval:1,scale:!0,axisLabel:{fontSize:9,formatter:function(e){const u=e.split(" ("),y=u[1].split(")")[0],l=y.split(" - ")[0],b=u[0].split("-");return`${b[2]}${b[1]}${b[0]}`,l=="00:00"?(Ae.value.includes(e)||Ae.value.push(e),e):y},rotate:45},splitLine:{show:!0,lineStyle:{type:"dashed"}},axisTick:{alignWithLabel:!0}}],yAxis:{type:"value",name:"Pressure (PSI)",nameGap:10,max:E.value,interval:20,axisTick:{show:!0,inside:!0},splitLine:{show:!0,lineStyle:{type:"solid",color:"#999"}},minorTick:{show:!0},minorSplitLine:{show:!0,lineStyle:{type:"dashed",color:"#ccc"}}},series:[]};p.value.setOption(a),setTimeout(()=>{p.value.dispatchAction({type:"legendInverseSelect"}),p.value.dispatchAction({type:"legendAllSelect"}),p.value.resize()},100)},M=a=>{const e={type:"line",name:a,xAxisIndex:0,data:[],markLine:{symbol:"none",symbolSize:0,data:[{xAxis:a}],lineStyle:{width:.7,type:"solid"},label:{color:"#fff",backgroundColor:"inherit",height:14,show:!0,formatter:function(l){const b=l.value.split(" (")[0];return F(b).format("ddd, DD MMM YYYY hh:mm:ss")},position:"middle",distance:-7}}},u=p.value.getOption();let y=!1;if(u.series.forEach(l=>{l.name==a&&(y=!0)}),!y){const l=p.value.getOption().series;l.push(e),p.value.setOption({series:l})}},U=()=>{const a=F().format("YYYY-MM-DD"),e=F(g.initDateFilter).format("YYYY-MM-DD");$e.value=a===e};mt(()=>{window.addEventListener("keyup",Yt),U()}),W(()=>A.value,()=>{T(),B(V.value)}),W(()=>g.initPlaybackDatas,(a,e)=>{!a||a.length===0||(U(),G(),B(V.value),se.value=!1,ne.value&&(z.value=!0))});const B=a=>{ce=[];for(let l of I.value[g.selectedSpot].spot)ve[l.name]=[];g.initPlaybackDatas.slice(0,a+1).forEach((l,b)=>{const S=`${l.dateFilter} (${l.timeRange})`;ce.push(S),ut.value=S,l.data.forEach(J=>{const ot=I.value[g.selectedSpot].spot.find(nt=>nt.id===J.idSpot).name,st=J.avgPsiValues??0;ve[ot][b]=Number(st.toFixed(2))})});const u=Object.keys(ve).map(l=>({name:l,type:"line",data:ve[l],showAllSymbol:he.value,smooth:!1,tooltip:{trigger:"axis",formatter:function(b){return b[0].value}},endLabel:{show:!0,formatter:function(b){return b.value+" ; "+l},color:"#000",backgroundColor:"inherit",padding:5,fontSize:10,borderRadius:5}}));let y=p.value.getOption();y.xAxis[0].data=ce,y.series=u,p.value.setOption(y),Ae.value.forEach(l=>{M(l)})},X=()=>{p.value.getOption()},G=()=>{z.value=!1,V.value=0,ue.value=[],clearInterval(pe),B(V.value),ge.value=V.value/g.initPlaybackDatas.length*100},Se=a=>{z.value=!1,ue.value=[],V.value=parseInt(a.target.value,10),B(V.value),ge.value=V.value/g.initPlaybackDatas.length*100};W(()=>g.initDateFilter,async()=>{pt(),dt(),await Ve().then(()=>{Ne()})});const Ne=()=>{const a=F(g.initDateFilter),e=a.add(1,"days").format("YYYY-MM-DD"),u=a.subtract(2,"days").format("YYYY-MM-DD");_e.value=e,ke.value=u};Ne();const Je=async()=>{pt(),await Ve().then(()=>{if($e.value)r.notifyShowError("End of playback");else{De.value=!0,G();const a=F(_e.value).format("YYYY-MM-DD");ne.value&&(z.value=!0),se.value=!0,$("onDateChange",a),setTimeout(()=>{De.value=!1},5e3)}})},Qe=async()=>{pt(),await Ve().then(()=>{De.value=!0,G();const a=F(ke.value).format("YYYY-MM-DD");ne.value&&(z.value=!0),se.value=!0,$("onDateChange",a),setTimeout(()=>{De.value=!1},5e3)})};W(()=>H.value,()=>{H.value&&(Re(),s.value=!1,ne.value=!1)}),W(()=>s.value,()=>{s.value?(H.value=!1,ne.value=!0):H.value=!0}),W(()=>ne.value,()=>{ne.value&&(H.value=!1)}),W(()=>z.value,()=>{if(!z.value&&V.value==g.initPlaybackDatas.length)if(H.value)G(),z.value=!0;else{const a=F().format("YYYY-MM-DD"),e=F(g.initDateFilter).format("YYYY-MM-DD");a===e?z.value=!1:s.value?d.value=="forward"?fe.value?g.initDateFilter!=me.value?Je():Ze.value?(G(),$("onDateChange",ye.value)):Re():Je():fe.value?g.initDateFilter!=ye.value?Qe():Ze.value?(G(),$("onDateChange",me.value)):Re():Qe():(G(),z.value=!0)}ae.value&&q.value?(bt(),yt(),X()):Xe()});const yt=()=>{if(z.value)Xe();else{const a=p.value.getOption();a.series.forEach(u=>{u.symbolSize=Z.value}),a.series.forEach(u=>{u.symbol="circle"});const e=p.value.getOption().tooltip;e.show=!0,p.value.setOption(a)}},Xe=()=>{const a=p.value.getOption();a.series.forEach(e=>{e.symbolSize=0}),a.series.forEach(e=>{e.symbol="none"}),p.value.setOption(a),p.value.off("click")},_=c({}),bt=()=>{p.value.off("click"),p.value.on("click",a=>{if(a.componentType==="markLine"){if(a.seriesName==="Normal"){r.notifyConfirm("Delete Normal","Are you sure?","Delete","Cancel",async()=>{gt()},()=>{});return}else r.notifyConfirm("Delete Marker","Delete this marker?","Delete","Cancel",async()=>{const b=p.value.getOption();b.series=b.series.filter((S,J)=>J!==a.seriesIndex),p.value.clear(),p.value.setOption(b),Object.keys(_.value).forEach(S=>{_.value[S].index===a.value&&delete _.value[S]}),h.value=!1,setTimeout(()=>{h.value=!0},100)},()=>{});return}const e=ce.findIndex(b=>b===a.name);if(e<0)return;if(_.value.normal){const b=Object.keys(_.value).length,S={type:"line",name:`Drop ${b}`,xAxisIndex:0,data:[],markLine:{symbol:"image://https://gpng.net/wp-content/uploads/ROBBER.png",symbolSize:35,data:[{xAxis:e,symbolRotate:180}],lineStyle:{color:"blue",width:2,type:"dotted"},label:{show:!0,formatter:`Drop ${b}`,position:"insideEndTop"}}},J=p.value.getOption().series;J.push(S),p.value.setOption({series:J})}else{const b={type:"line",name:"Normal",xAxisIndex:0,data:[],markLine:{symbol:"image://https://png.pngtree.com/png-clipart/20230325/original/pngtree-petroleum-workers-or-miners-vector-png-image_9004441.png",symbolSize:42,data:[{xAxis:e}],lineStyle:{color:"red",width:2,type:"dotted"},label:{show:!0,formatter:"Normal",position:"insideEndTop"}}},S=p.value.getOption().series;S.push(b),p.value.setOption({series:S})}const l=p.value.getOption().series.filter(b=>Array.isArray(b.data)).map(b=>({seriesName:b.name,yValue:b.data[e]??0}));if(_.value.normal){const b=Object.keys(_.value).length;_.value[`drop${b}`]={index:e,name:`Drop ${b}`,data:l,order:p.value.getOption().series.length-1,type:"drop",timerange:ce[e].split(" (")[1].split(")")[0],seriesName:ce[e].split(" (")[1].split(")")[0]+".drop."+g.initDateFilter,date:g.initDateFilter}}else{const b={normal:{index:e,name:"Normal",data:l,order:0,type:"normal",timerange:ce[e].split(" (")[1].split(")")[0],seriesName:ce[e].split(" (")[1].split(")")[0]+".normal."+g.initDateFilter,date:g.initDateFilter}};_.value={...b,..._.value},x.value=b.normal.seriesName}})},gt=()=>{const a=p.value.getOption();a.series=a.series.filter(e=>e.name!=="Normal"),p.value.clear(),p.value.setOption(a),delete _.value.normal,r.notifyShow("Normal deleted"),x.value=null},Ve=()=>new Promise((a,e)=>{try{if(Object.keys(_.value).length===0){a();return}const u=p.value.getOption();u.series=u.series.filter(y=>!y.markLine),p.value.clear(),p.value.setOption(u),_.value={},a()}catch(u){e(u)}});W(()=>[z.value,de.value],()=>{z.value?(pe!=null&&clearInterval(pe),pe=setInterval(()=>{V.value<g.initPlaybackDatas.length?(V.value++,g.initPlaybackDatas[V.value]!=null&&(B(V.value),ge.value=V.value/g.initPlaybackDatas.length*100)):(z.value=!1,clearInterval(pe))},de.value)):pe&&(clearInterval(pe),pe=null)}),W(()=>[r.asideVisible],()=>{setTimeout(()=>{p.value.resize()},500)});const ze=c(!1),Pt=()=>d.value=="forward"?_e.value:ke.value,we=c(!1),fe=c(!1),Ze=c(!0),ye=c(""),me=c(""),Ot=()=>{ye.value?me.value?(fe.value=!0,H.value=!1,s.value=!0,ne.value=!0,we.value=!1,z.value=!1):r.notifyShowError("Date 2 is required"):r.notifyShowError("Date 1 is required")};W(()=>we.value,()=>{we.value?(z.value=!1,fe.value=!1):z.value=!0}),W(()=>[fe.value],()=>{fe.value&&(G(),d.value=="forward"?$("onDateChange",ye.value):$("onDateChange",me.value))}),W(()=>d.value,()=>{d.value=="backward"&&(G(),Re())});const Re=()=>{G(),$("onDateChange",g.initDateFilter),fe.value=!1,ye.value=null,me.value=null},Yt=a=>{O.value||((a.keyCode==80||a.keyCode==32)&&(z.value=!z.value),a.keyCode==37&&Qe(),a.keyCode==39&&Je())},Lt=(a,e)=>{if(a.type=="normal"){r.notifyConfirm("Delete Normal","Are you sure?","Delete","Cancel",async()=>{gt()},()=>{});return}const u=p.value.getOption();u.series=u.series.filter(y=>y.name!==a.name),p.value.clear(),p.value.setOption(u),delete _.value[e],h.value=!1,setTimeout(()=>{h.value=!0},100)},ae=c(null),q=c(null),re=c(!1),Fe=c(!1),Tt=()=>{Fe.value?(re.value=!1,Fe.value=!1):(ae.value=null,q.value=null,re.value=!1)};W(()=>re.value,()=>{Fe.value=!1});const dt=()=>{ae.value=null,q.value=null,re.value=!1,Xe(),Ve(),_.value={}};W(()=>[ae.value,q.value],()=>{ae.value&&q.value?(bt(),yt()):(Xe(),r.notifyShow("Prediction stopped"))});const Et=()=>{Fe.value=!0,re.value=!0},je=c(!1),kt=c([]),ee=c([]),Oe=c(!1),et=c(),At=c(),Nt=()=>{const a=Vt();if(console.log(a),!ae.value||!q.value){r.notifyShowError("Please select model and method");return}r.notifyShow("Prediction started"),re.value=!1;let e={};Object.keys(_.value).forEach(y=>{if(_.value[y].type!=="normal"||_.value[y].type!=="drop"){const l=Y.getAllTrunk().trunk1.spot.length;let b={name:_.value[y].name,data:_.value[y].data.map(S=>({avgPsiValues:S.yValue})).slice(0,l),type:_.value[y].type};e[_.value[y].name]=b}}),kt.value=[];const u=N.mlpredict(e,q.value);if(je.value=!0,q.value==="rf_single"?setTimeout(()=>{ee.value=u.sort((y,l)=>y.drop-l.drop),Ye(a)},4e3):q.value==="rf4_multi"?setTimeout(()=>{ee.value=u.sort((y,l)=>y.drop-l.drop),Ye(a)},4e3):q.value==="lr_single"?setTimeout(()=>{ee.value=u.sort((y,l)=>y.drop-l.drop),Ye(a)},4e3):q.value==="dt_single"?setTimeout(()=>{ee.value=u.sort((y,l)=>y.drop-l.drop),Ye(a)},4e3):q.value==="dt4_multi"?setTimeout(()=>{ee.value=u.sort((y,l)=>y.drop-l.drop),Ye(a)},4e3):q.value==="dynamic"&&setTimeout(()=>{ee.value=u.sort((y,l)=>y.drop-l.drop),Ye(a)},4e3),ee.value!=null)for(let y=0;y<ee.value.length;y++)ee.value[y].suspectLocation.leak&&kt.value.push(ee.value[y])},Ye=a=>{for(let e=0;e<ee.value.length;e++){const u=ee.value[e].drop,y=a.find(l=>l.dropnum===u);ee.value[e].date=y.date,ee.value[e].time=y.time}},Vt=()=>{const a=[];let e=0;return Object.keys(_.value).forEach(u=>{_.value[u].type==="drop"&&a.push({date:_.value[u].date,time:_.value[u].timerange,dropnum:e}),e++}),a},ht=c(),wt=c(),zt=(a,e,u)=>{et.value=a,Oe.value=!1,Oe.value=!0,ht.value=e,wt.value=u};W(()=>je.value,()=>{je.value||(Oe.value=!1,ee.value=null,et.value=null,At.value=null)});const Rt=async a=>{f.value=a,await navigator.clipboard.writeText(f.value),r.notifyShow("Coordinate copied to clipboard")},tt=a=>{const e=Math.floor(a),u=Math.abs(a-e)*60,y=Math.floor(u),l=(u-y)*60;return`${e}° ${y}' ${l.toFixed(2)}"`};W(()=>he.value,()=>{if(he.value){Z.value=5;const a=p.value.getOption();a.series.forEach(e=>{e.showAllSymbol=!0}),a.series.forEach(e=>{e.symbolSize=Z.value}),p.value.setOption(a)}else{Z.value=7;const a=p.value.getOption();a.series.forEach(e=>{e.showAllSymbol=!1}),a.series.forEach(e=>{e.symbolSize=Z.value}),p.value.setOption(a)}}),W(()=>Z.value,()=>{const a=p.value.getOption();a.series.forEach(e=>{e.symbolSize=Z.value}),p.value.setOption(a)});const pt=()=>{Z.value=7,he.value=!1;const a=p.value.getOption();a.series.forEach(e=>{e.symbolSize=Z.value,e.showAllSymbol=!1}),p.value.setOption(a)},Ce=c(!1);W(()=>_.value,()=>{te.value={},Object.keys(_.value).forEach(a=>{const e=_.value[a].seriesName,u=_.value[a].data,l=u.map(b=>{const S=Y.getAllTrunk().trunk1.spot.find(J=>J.name===b.seriesName);if(S!==void 0)return S.id}).filter(b=>b!==void 0);te.value[e]===void 0&&(te.value[e]=[]),l.length>0&&(te.value[e]={date:_.value[a].date,timerange:_.value[a].timerange,type:_.value[a].type,data:l.map((b,S)=>({idSpot:b,avgPsiValues:u[S].yValue}))})})},{deep:!0});const xt=(a,e)=>{const y=te.value[a].data;for(let l=0;l<y.length;l++)if(y[l].idSpot==e)return y[l].avgPsiValues.toFixed(2)};it(()=>{var a;if(te.value!=null&&(Ee=Object.keys(te.value),x.value!=null)){v.value=[];const e=x.value,u=(a=te.value[e])==null?void 0:a.data;Ee.filter(l=>l!==e).forEach(l=>{const b=te.value[l].data,S=[];I.value.trunk1.spot.forEach((J,ot)=>{const st=J.id,nt=u.find(qe=>qe.idSpot===st),Mt=b.find(qe=>qe.idSpot===st);if(nt&&Mt){const qe=nt.avgPsiValues.toFixed(2)-Mt.avgPsiValues.toFixed(2);S[ot]=qe}else S[ot]=0}),v.value.push({dropKey:l,deltas:S})})}});const ct=a=>a.spot,lt=c(!1),Ie=c(""),Ue=c(""),Ft=()=>{z.value=!1,lt.value=!0,O.value=!0},jt=()=>{lt.value=!1,O.value=!1},It=()=>{if(Ie.value==""||Ue.value==""){r.notifyShowError("Name and description are required");return}r.notifyShow("Saving preset. Please wait..."),lt.value=!1;const a={name:Ie.value,desc:Ue.value,selectedModel:ae.value,selectedMethod:q.value,selections:_.value,seekerValue:V.value};$("onDataSave",a),Ie.value="",Ue.value=""},Ut=()=>{$("onLoadPreset")},Bt=()=>{r.notifyShow("Snapshot loaded"),ae.value=g.snapShots.selectedModel,q.value=g.snapShots.selectedMethod,setTimeout(()=>{V.value=g.snapShots.seekerValue,setTimeout(()=>{_.value=g.snapShots.selection;const a=p.value.getOption().series;Object.keys(_.value).forEach(u=>{const y=_.value[u];y.type==="normal"?(a.push({type:"line",name:"Normal",xAxisIndex:0,data:[],markLine:{symbol:"image://https://png.pngtree.com/png-clipart/20230325/original/pngtree-petroleum-workers-or-miners-vector-png-image_9004441.png",symbolSize:42,data:[{xAxis:y.index}],lineStyle:{color:"red",width:2,type:"dotted"},label:{show:!0,formatter:"Normal",position:"insideEndTop"}}}),x.value=y.seriesName):a.push({type:"line",name:y.name,xAxisIndex:0,data:[],markLine:{symbol:"image://https://gpng.net/wp-content/uploads/ROBBER.png",symbolSize:35,data:[{xAxis:y.index,symbolRotate:180}],lineStyle:{color:"blue",width:2,type:"dotted"},label:{show:!0,formatter:y.name,position:"insideEndTop"}}})}),p.value.setOption({series:a});const e=p.value.getOption();p.value.clear(),p.value.setOption(e)},1e3),B(V.value)},3e3)};it(()=>{p.value&&g.snapShots&&Object.keys(g.snapShots).length>0&&Bt()});const qt=(a,e)=>{let u=!0;return e.forEach(y=>{a<y&&(u=!1)}),u},Kt=(a,e)=>{let u=0;e.forEach(l=>{u<l&&(u=l)});let y=!0;return e.forEach(l=>{a<l&&l<u&&(y=!1)}),y},Wt=(a,e)=>{let u=0;e.forEach(b=>{u<b&&(u=b)});let y=0;e.forEach(b=>{y<b&&b<u&&(y=b)});let l=!0;return e.forEach(b=>{a<b&&b<y&&(l=!1)}),l},Ht=(a,e)=>{let u=!0;return e.forEach(y=>{a>y&&(u=!1)}),u},Gt=()=>{p.value&&p.value.resize()},Be=c(!1);W(()=>E.value,()=>{E.value<0&&(E.value=0);const a=p.value.getOption();a.yAxis[0].max=E.value,p.value.setOption(a)});const Le=c(!1),at=c("predict"),Dt=c([]),vt=c(!1),Jt=async()=>{at.value==="predict"?(Nt(),Le.value=!1):(Le.value=!1,await D.startPrediction(_.value).then(a=>{a.success?(Dt.value=a.result,vt.value=!0):r.notifyShowError(a.message)}).catch(a=>{r.notifyShowError(a)}))};return(a,e)=>{const u=Te("font-awesome-icon"),y=Te("center");return o(),n(R,null,[we.value?(o(),n("div",Cl,[t("div",$l,[e[38]||(e[38]=t("h2",null,[t("b",null,"Select Range")],-1)),e[39]||(e[39]=t("p",{style:{padding:"0",margin:"0"}},"Automatically plays the playback based on current setup",-1)),i(xe,{"in-label":"Speed","model-value":de.value,"onUpdate:modelValue":e[0]||(e[0]=l=>de.value=l)},{default:C(()=>e[35]||(e[35]=[t("option",{value:"1000"},"Slowest",-1),t("option",{value:"500"},"Slower",-1),t("option",{value:"300"},"Moderate",-1),t("option",{value:"250"},"Faster",-1),t("option",{value:"200"},"Fastest",-1)])),_:1},8,["model-value"]),i(be,{"in-type":"date","in-label":"Date 1","model-value":ye.value,"onUpdate:modelValue":e[1]||(e[1]=l=>ye.value=l)},null,8,["model-value"]),i(be,{"in-type":"date","in-label":"Date 2","model-value":me.value,"onUpdate:modelValue":e[2]||(e[2]=l=>me.value=l)},null,8,["model-value"]),t("div",_l,[i(L,{onClick:Ot,"bt-disabled":!1,style:{width:"fit-content"}},{default:C(()=>e[36]||(e[36]=[m("Apply Filter")])),_:1}),i(L,{onClick:e[3]||(e[3]=l=>we.value=!we.value),"bt-disabled":!1,style:{width:"fit-content"}},{default:C(()=>e[37]||(e[37]=[m("Cancel ")])),_:1})])])])):P("",!0),ze.value?(o(),n("div",Pl,[t("div",Ol,[e[42]||(e[42]=t("h2",null,[t("b",null,"Select Preference")],-1)),i(xe,{"in-label":"Select","model-value":d.value,"onUpdate:modelValue":e[4]||(e[4]=l=>d.value=l)},{default:C(()=>e[40]||(e[40]=[t("option",{value:"forward"},"Forward",-1),t("option",{value:"backward"},"Backward",-1)])),_:1},8,["model-value"]),i(L,{onClick:e[5]||(e[5]=l=>ze.value=!ze.value),style:{width:"fit-content"},"bt-disabled":!1},{default:C(()=>[i(u,{icon:"save"}),e[41]||(e[41]=m(" Save & Apply"))]),_:1})])])):P("",!0),e[107]||(e[107]=t("h5",{style:{"text-align":"center"}},[t("b",null,"Playback")],-1)),i(y,null,{default:C(()=>[i(xe,{style:{width:"400px"},"in-label":"Speed","model-value":de.value,"onUpdate:modelValue":e[6]||(e[6]=l=>de.value=l)},{default:C(()=>e[43]||(e[43]=[t("option",{value:"1000"},"Slowest",-1),t("option",{value:"500"},"Slower",-1),t("option",{value:"300"},"Moderate",-1),t("option",{value:"250"},"Faster",-1),t("option",{value:"200"},"Fastest",-1)])),_:1},8,["model-value"])]),_:1}),t("div",Yl,[!z.value&&!q.value&&!ae.value?(o(),oe(L,{key:0,onClick:e[7]||(e[7]=l=>re.value=!re.value),"bt-disabled":!1},{default:C(()=>[i(u,{icon:"atom"}),e[44]||(e[44]=m(" Leak Detection"))]),_:1})):P("",!0),z.value?P("",!0):(o(),oe(L,{key:1,onClick:Ut,"bt-disabled":!1},{default:C(()=>[i(u,{icon:"download"}),e[45]||(e[45]=m(" Import Snapshot "))]),_:1})),q.value&&ae.value?(o(),oe(L,{key:2,onClick:e[8]||(e[8]=l=>Me.value=!Me.value),"bt-disabled":!1},{default:C(()=>[i(u,{icon:"sliders"}),e[46]||(e[46]=m(" Settings "))]),_:1})):P("",!0),q.value&&ae.value?(o(),oe(L,{key:3,style:{background:"red"},onClick:dt,"bt-disabled":!1},{default:C(()=>[i(u,{icon:"close"}),e[47]||(e[47]=m(" Quit Prediction"))]),_:1})):P("",!0)]),t("div",Ll,[t("div",Tl,[t("label",{class:ie([`${w(r).textTheme}`]),style:{cursor:"pointer",padding:"10px",border:"1px solid #ccc","margin-bottom":"1rem","border-radius":"10px"}},[Ke(t("input",{"onUpdate:modelValue":e[9]||(e[9]=l=>H.value=l),type:"checkbox"},null,512),[[We,H.value]]),e[48]||(e[48]=m(" Auto-replay "))],2),t("label",{class:ie([`${w(r).textTheme}`]),style:{cursor:"pointer",padding:"10px",border:"1px solid #ccc","margin-bottom":"1rem","border-radius":"10px"}},[Ke(t("input",{"onUpdate:modelValue":e[10]||(e[10]=l=>ne.value=l),type:"checkbox"},null,512),[[We,ne.value]]),e[49]||(e[49]=m(" Autoplay on navigating "))],2),t("label",{class:ie([`${w(r).textTheme}`]),style:{cursor:"pointer",padding:"10px",border:"1px solid #ccc","margin-bottom":"1rem","border-radius":"10px"}},[Ke(t("input",{"onUpdate:modelValue":e[11]||(e[11]=l=>s.value=l),type:"checkbox"},null,512),[[We,s.value]]),e[50]||(e[50]=m(" Self Navigate "))],2),s.value?(o(),oe(L,{key:0,onClick:e[12]||(e[12]=l=>ze.value=!ze.value),"bt-disabled":!1,type:"button",class:"slfnavbtn"},{default:C(()=>[i(u,{icon:"sliders"})]),_:1})):P("",!0)]),t("div",El,[fe.value?(o(),n("label",{key:0,class:ie([`${w(r).textTheme}`]),style:{border:"1px solid #ccc",padding:"10px","border-radius":"10px"}},[m(k(w(F)(ye.value).format("ddd, DD MMM YY"))+"    ",1),i(u,{icon:d.value=="forward"?"caret-right":"caret-left"},null,8,["icon"]),m("    "+k(w(F)(me.value).format("ddd, DD MMM YY")),1)],2)):P("",!0),fe.value?(o(),n("label",{key:1,class:ie([`${w(r).textTheme}`]),style:{cursor:"pointer",padding:"10px",border:"1px solid #ccc","border-radius":"10px"}},[Ke(t("input",{"onUpdate:modelValue":e[13]||(e[13]=l=>Ze.value=l),type:"checkbox"},null,512),[[We,Ze.value]]),e[51]||(e[51]=m(" Repeat "))],2)):P("",!0),i(L,{onClick:e[14]||(e[14]=l=>we.value=!we.value),"bt-disabled":!1,type:"button",class:"slfnavbtn"},{default:C(()=>[i(u,{icon:"calendar"})]),_:1}),ye.value&&me.value?(o(),oe(L,{key:2,onClick:Re,"bt-disabled":!1,class:"slfnavbtn"},{default:C(()=>[i(u,{icon:"close"})]),_:1})):P("",!0)])]),t("div",Al,[i(L,{"bt-disabled":De.value,onClick:Qe},{default:C(()=>[i(u,{icon:"backward"}),m("    "+k(w(F)(ke.value).format("ddd, DD MMM YY")),1)]),_:1},8,["bt-disabled"]),t("span",Nl,[t("b",{style:Q({color:`${w(r).accentColor}`})},k(w(F)(g.initDateFilter).format("ddd, DD MMM YY")),5),e[55]||(e[55]=t("br",null,null,-1)),fe.value?(o(),n("span",{key:0,class:ie([`${w(r).textTheme}`]),style:{"font-size":"11px"}},[e[52]||(e[52]=m("Stops at: ")),t("b",null,k(w(F)(me.value).format("ddd, DD MMM YY")),1)],2)):(o(),n(R,{key:1},[H.value?(o(),n("span",Vl,[e[53]||(e[53]=m("Repeating: ")),t("b",null,k(w(F)(g.initDateFilter).format("ddd, DD MMM YY")),1)])):(o(),n(R,{key:1},[$e.value?(o(),n("span",Rl,"[End of playback  ·  Autoplay stopped]")):(o(),n("span",zl,[e[54]||(e[54]=m("Upcoming: ")),t("b",null,k(w(F)(Pt()).format("ddd, DD MMM YY")),1)]))],64))],64))]),i(L,{"bt-disabled":$e.value,onClick:Je},{default:C(()=>[m(k(w(F)(_e.value).format("ddd, DD MMM YY"))+"    ",1),i(u,{icon:"forward"})]),_:1},8,["bt-disabled"])]),t("div",{style:Q([{position:"relative",width:"100%"},{marginBottom:Object.keys(_.value).length>1?"8rem":"0"}])},[t("div",{ref_key:"heatMap",ref:A,style:{width:"100%",height:"600px"}},null,512),t("div",Fl,[t("div",jl,[z.value?P("",!0):(o(),n("button",{key:0,style:{"z-index":"1",position:"relative"},onClick:e[15]||(e[15]=l=>z.value=!z.value),class:"controlbtn",type:"button"},[i(u,{icon:"play"})])),z.value?(o(),n("button",{key:1,style:{"z-index":"1",position:"relative"},onClick:e[16]||(e[16]=l=>z.value=!z.value),class:"controlbtn",type:"button"},[i(u,{icon:"pause"})])):P("",!0)]),t("div",Il,[t("input",{onChange:Se,type:"range",min:0,max:g.initPlaybackDatas.length,value:V.value,class:"slider"},null,40,Ul)]),t("div",null,[!z.value&&V.value==g.initPlaybackDatas.length?(o(),n("button",{key:0,onClick:G,class:"controlbtn",type:"button"},[i(u,{icon:"undo"})])):P("",!0)])]),Object.keys(_.value).length?(o(),n("div",Bl,[t("div",ql,[(o(!0),n(R,null,K(_.value,(l,b)=>(o(),n("div",{key:b,class:"selection-item",onClick:S=>Lt(l,b)},[t("h5",{style:Q({color:l.type=="normal"?"red":"blue"})},[t("b",null,k(l.name),1)],4),(o(!0),n(R,null,K(l.data,S=>(o(),n("div",{key:S.seriesName},[S.seriesName!="Normal"&&!S.seriesName.includes("Drop")?(o(),n("span",Wl,[t("span",Hl,k(S.seriesName),1),e[56]||(e[56]=m()),t("span",Gl,[t("b",null,k(S.yValue)+" PSI",1)])])):P("",!0)]))),128))],8,Kl))),128))]),t("div",Jl,[e[61]||(e[61]=t("h4",{style:{"text-align":"center"}},[t("b",null,"Pressure Distribution")],-1)),h.value?(o(),oe(cl,{key:0,style:{width:"100%"},data:w(te),"selected-spot":"trunk1"},null,8,["data"])):P("",!0),t("img",{src:w(al),alt:"map",style:{width:"100%",height:"600px","border-radius":"10px","object-fit":"contain"}},null,8,Ql),t("div",Xl,[t("h5",Zl,[t("b",null,[i(u,{icon:"oil-well"}),e[57]||(e[57]=m(" Selected Pressures"))])]),t("table",ea,[t("thead",null,[t("tr",{style:{padding:"5px"},class:ie([`${w(r).textTheme}`])},[t("th",{style:Q({border:`1px solid ${w(r).accentColor}`})},"ACTION",4),t("th",{style:Q({border:`1px solid ${w(r).accentColor}`})},"PINNED SERIES",4),(o(!0),n(R,null,K(ct(I.value.trunk1),(l,b)=>(o(),n("th",{style:Q({border:`1px solid ${w(r).accentColor}`}),key:b},k(l.name),5))),128))],2)]),t("tbody",null,[(o(!0),n(R,null,K(w(Ee),(l,b)=>(o(),n("tr",{key:b},[t("td",{style:Q({border:`1px solid ${w(r).accentColor}`,position:"relative",textTransform:"uppercase",fontWeight:"bold"})},null,4),t("td",{class:ie([`${w(r).textTheme}`]),style:Q({border:`1px solid ${w(r).accentColor}`,position:"relative",textTransform:"uppercase",fontWeight:"bold"})},[m(k(w(te)[l].date),1),e[58]||(e[58]=t("br",null,null,-1)),m(" "+k(w(te)[l].timerange),1),e[59]||(e[59]=t("br",null,null,-1)),m(" "+k(w(te)[l].type),1)],6),(o(!0),n(R,null,K(ct(I.value.trunk1),(S,J)=>(o(),n("td",{style:Q({border:`1px solid ${w(r).accentColor}`}),class:ie([`${w(r).textTheme}`]),key:J},[xt(l,S.id)?(o(),n(R,{key:0},[m(k(xt(l,S.id)),1)],64)):(o(),n(R,{key:1},[m("0.00")],64))],6))),128))]))),128))])]),t("h5",ta,[t("b",null,[i(u,{icon:"turn-down"}),e[60]||(e[60]=m(" Delta"))])]),t("table",la,[t("thead",null,[t("tr",{style:{padding:"5px"},class:ie([`${w(r).textTheme}`])},[t("th",{style:Q({border:`1px solid ${w(r).accentColor}`})},"DROPS",4),t("th",{style:Q({border:`1px solid ${w(r).accentColor}`})},"PINNED SERIES",4),(o(!0),n(R,null,K(ct(I.value.trunk1),(l,b)=>(o(),n("th",{style:Q({border:`1px solid ${w(r).accentColor}`}),key:b},k(l.name),5))),128))],2)]),t("tbody",null,[(o(!0),n(R,null,K(v.value,(l,b)=>(o(),n("tr",{key:b},[t("td",{style:Q({border:`1px solid ${w(r).accentColor}`})},k(b+1),5),t("td",{style:Q({border:`1px solid ${w(r).accentColor}`})},k(l.dropKey.split(".")[0]+"."+l.dropKey.split(".")[1]+"."+l.dropKey.split(".")[2]),5),(o(!0),n(R,null,K(l.deltas,(S,J)=>(o(),n("td",{key:J,style:Q({border:`1px solid ${w(r).accentColor}`})},[qt(S,l.deltas)?(o(),n("span",aa,k(S.toFixed(2)),1)):Kt(S,l.deltas)?(o(),n("span",oa,k(S.toFixed(2)),1)):Wt(S,l.deltas)?(o(),n("span",sa,k(S.toFixed(2)),1)):Ht(S,l.deltas)?(o(),n("span",na,k(S.toFixed(2)),1)):(o(),n("span",ia,k(S.toFixed(2)),1))],4))),128))]))),128))])])])])])):P("",!0)],4),se.value?(o(),n("div",ra,e[62]||(e[62]=[t("img",{src:"https://cdn.dribbble.com/users/1138184/screenshots/3796132/oil.gif"},null,-1)]))):P("",!0),re.value?(o(),n("div",ua,[t("div",da,[t("button",{onClick:Tt,class:"modelpick-dismiss"},[i(u,{icon:"times"})]),e[65]||(e[65]=t("h2",null,[t("b",null,"Leak Detection")],-1)),i(xe,{"in-label":"Select Model","model-value":ae.value,"onUpdate:modelValue":e[17]||(e[17]=l=>ae.value=l)},{default:C(()=>e[63]||(e[63]=[t("option",{value:""},"Select...",-1),t("option",{value:"normal_pick"},"Normal Pick",-1),t("option",{value:"ranged_pick"},"Ranged Pick",-1)])),_:1},8,["model-value"]),i(xe,{"in-label":"Select Prediction Method","model-value":q.value,"onUpdate:modelValue":e[18]||(e[18]=l=>q.value=l)},{default:C(()=>e[64]||(e[64]=[t("option",{value:""},"Select method...",-1),t("option",{value:"rf_single"},"RF Single-leak",-1),t("option",{value:"rf4_multi"},"RF4 Multi-leak",-1),t("option",{value:"dt_single"},"DT Single-leak",-1),t("option",{value:"dt4_multi"},"DT4 Multi-leak",-1),t("option",{value:"lr_single"},"LR Single-leak",-1),t("option",{value:"dynamic"},"Dynamic",-1)])),_:1},8,["model-value"]),i(L,{onClick:e[19]||(e[19]=l=>re.value=!re.value),style:{width:"fit-content","margin-top":"0.5rem"},"bt-disabled":!1},{default:C(()=>[m(k(Fe.value?"Update Preference":"Start Picking"),1)]),_:1})])])):P("",!0),Object.keys(_.value).length>1&&!Ce.value?(o(),n("div",pa,[t("button",{type:"button",class:"predict-action-hide",onClick:e[20]||(e[20]=l=>Ce.value=!Ce.value)},[i(u,{icon:"eye-slash"})]),t("div",ca,[e[66]||(e[66]=m("Picking Model: ")),t("b",null,k(ae.value.split("_").map(l=>l.charAt(0).toUpperCase()+l.slice(1)).join(" ")),1),e[67]||(e[67]=m(" ··· Prediction Method: ")),t("b",null,k(q.value.split("_").map(l=>l.charAt(0).toUpperCase()+l.slice(1)).join(" ")),1)]),t("div",va,[e[68]||(e[68]=m("Num of drops: ")),t("b",null,k(Object.keys(_.value).filter(l=>_.value[l].type=="drop").length),1)]),t("div",fa,[i(L,{"bt-size":"small",onClick:e[21]||(e[21]=l=>Le.value=!0),"bt-disabled":!1,style:{width:"fit-content"}},{default:C(()=>[i(u,{icon:"check"}),e[69]||(e[69]=m(" Predict "))]),_:1}),i(L,{"bt-size":"small",onClick:Ft,"bt-disabled":!1,style:{width:"fit-content",background:"rgb(0,150,255)"}},{default:C(()=>[i(u,{icon:"plus"}),e[70]||(e[70]=m(" Create Snapshot "))]),_:1}),i(L,{"bt-size":"small",onClick:Et,"bt-disabled":!1,style:{width:"fit-content",background:"#666"}},{default:C(()=>[i(u,{icon:"refresh"}),e[71]||(e[71]=m(" Change Method "))]),_:1}),i(L,{"bt-size":"small",onClick:Ve,"bt-disabled":!1,style:{width:"fit-content",background:"orange"}},{default:C(()=>[i(u,{icon:"trash"}),e[72]||(e[72]=m(" Clear Selection "))]),_:1}),i(L,{"bt-size":"small",onClick:dt,"bt-disabled":!1,style:{width:"fit-content",background:"red"}},{default:C(()=>[i(u,{icon:"close"}),e[73]||(e[73]=m(" Quit Prediction "))]),_:1})])])):P("",!0),je.value?(o(),n("div",ma,[t("div",{class:ie(["leak-body",[`${w(r).mTheme}`]])},[t("button",{type:"button",onClick:e[22]||(e[22]=l=>je.value=!1),class:"leak-dismiss"},[i(u,{icon:"times"})]),t("div",{class:"l-left",style:Q({width:Oe.value?"40%":"100%"})},[e[88]||(e[88]=t("h4",{style:{"font-weight":"bold"}},"Leak Analysis",-1)),e[89]||(e[89]=t("hr",null,null,-1)),ee.value?(o(!0),n(R,{key:0},K(ee.value,(l,b)=>(o(),n("div",{class:"analysis-set",key:b},[l!=!1?(o(),n(R,{key:0},[t("h4",ya,[t("b",null," DROP "+k(l.drop),1)]),t("p",null,[e[86]||(e[86]=m(" Result: ")),l!=!1&&l.suspectLocation.leak?(o(),n(R,{key:0},[e[84]||(e[84]=t("b",{style:{color:"red"}},"Possible leak detected!",-1)),t("div",ba,[t("table",ga,[t("tr",null,[e[74]||(e[74]=t("th",{style:{border:"1px solid #ccc",padding:"10px"}},"Estimated Leak Point",-1)),e[75]||(e[75]=t("th",{style:{border:"1px solid #ccc",padding:"10px"}},"Date & Time",-1)),l.suspectLocation.leakData.pu_location?(o(),n("th",ka," PU ")):P("",!0),l.suspectLocation.leakData.coordinate?(o(),n("th",ha," Coordinate ")):P("",!0)]),t("tbody",null,[t("tr",null,[t("td",wa,k(l.suspectLocation.leakData.leak_point)+" KM ",1),t("td",null,[t("b",null,k(w(F)(l.date).format("dddd, DD MMM YYYY")),1),e[76]||(e[76]=t("br",null,null,-1)),m(k(l.time)+" WIB ",1)]),l.suspectLocation.leakData.pu_location?(o(),n("td",xa," KM "+k(l.suspectLocation.leakData.pu_location),1)):P("",!0),l.suspectLocation.leakData.coordinate?(o(),n("td",Da,[e[78]||(e[78]=m(" LatLng: ")),t("code",null,k(l.suspectLocation.leakData.coordinate.latitude+", "+l.suspectLocation.leakData.coordinate.longitude),1),e[79]||(e[79]=t("br",null,null,-1)),e[80]||(e[80]=m(" DMS: ")),t("code",null,k(`${tt(l.suspectLocation.leakData.coordinate.latitude)}, ${tt(l.suspectLocation.leakData.coordinate.longitude)}`),1),e[81]||(e[81]=t("br",null,null,-1)),i(L,{onClick:S=>Rt(`LATLNG: ${l.suspectLocation.leakData.coordinate.latitude}, ${l.suspectLocation.leakData.coordinate.longitude}
DMS: ${tt(l.suspectLocation.leakData.coordinate.latitude)}, ${tt(l.suspectLocation.leakData.coordinate.longitude)}`),style:{"margin-top":"5px"},"bt-disabled":!1,"bt-size":"small"},{default:C(()=>[i(u,{icon:"copy"}),e[77]||(e[77]=m(" Copy Coord "))]),_:2},1032,["onClick"])])):P("",!0)])])])]),l.suspectLocation.leakData.coordinate?P("",!0):(o(),n("p",Ma,[i(u,{icon:"info-circle"}),e[82]||(e[82]=m(" Map view and PU Location data is currently not supported for this line "))])),i(L,{onClick:S=>zt(l.suspectLocation.leakData.coordinate,l.suspectLocation.leakData.leak_point,l.suspectLocation.leakData.pu_location),"bt-disabled":!l.suspectLocation.leakData.coordinate},{default:C(()=>[i(u,{icon:"map-marker"}),e[83]||(e[83]=m(" Pinpoint on Map"))]),_:2},1032,["onClick","bt-disabled"]),l.suspectLocation.leakData.coordinate?(o(),n("a",{key:1,class:"gmaps",target:"_blank",href:`https://www.google.com/maps?q=${l.suspectLocation.leakData.coordinate.latitude},${l.suspectLocation.leakData.coordinate.longitude}`,style:{"margin-left":"0.5rem"}},"Google Maps",8,Sa)):P("",!0)],64)):(o(),n(R,{key:1},[e[85]||(e[85]=t("b",{style:{color:"#555"}},"No leak detected",-1)),t("ol",Ca,[(o(!0),n(R,null,K(l.suspectLocation.probabilities,(S,J)=>(o(),n("li",{key:J},k(S),1))),128))])],64))])],64)):(o(),n("h6",$a,[t("b",null,"Analysis on Dataset "+k(b+1),1),e[87]||(e[87]=t("b",{style:{color:"#555"}},"Tidak ada indikasi",-1)),t("ol",_a,[(o(!0),n(R,null,K(l.suspectLocation.probabilities,(S,J)=>(o(),n("li",{key:J},k(S),1))),128))])]))]))),128)):(o(),oe(sl,{key:1,message:"Calculating leak probabilities..."}))],4),Oe.value?(o(),n("div",{key:0,class:"l-right",style:Q({width:Oe.value?"60%":"100%",position:"relative"})},[e[90]||(e[90]=t("h4",{style:{"font-weight":"bold"}},"Map View",-1)),e[91]||(e[91]=t("hr",null,null,-1)),i(ol,{latitude:et.value.latitude,longitude:et.value.longitude,"leak-point":ht.value,"pu-location":wt.value},null,8,["latitude","longitude","leak-point","pu-location"])],4)):P("",!0)],2)])):P("",!0),Me.value?(o(),n("div",Pa,[t("div",Oa,[e[94]||(e[94]=t("h5",null,[t("b",null,"Prediction Mode Preferences")],-1)),e[95]||(e[95]=t("hr",null,null,-1)),i(be,{"in-label":"Dot Symbol Size","model-value":Z.value,"onUpdate:modelValue":e[23]||(e[23]=l=>Z.value=l),"in-type":"number"},null,8,["model-value"]),t("label",Ya,[Ke(t("input",{type:"checkbox","onUpdate:modelValue":e[24]||(e[24]=l=>he.value=l)},null,512),[[We,he.value]]),e[92]||(e[92]=t("div",{style:{display:"flex","flex-flow":"column","margin-left":"0.7rem"}},[t("span",{style:{"font-size":"13px"}},[t("b",null,"Show all dots")]),t("span",{style:{"font-size":"11px"}},"Show all dots or reduce the dot placement")],-1))]),i(L,{onClick:e[25]||(e[25]=l=>Me.value=!Me.value),style:{width:"fit-content"},"bt-disabled":!1},{default:C(()=>e[93]||(e[93]=[m("Save Preferences")])),_:1})])])):P("",!0),lt.value?(o(),n("div",La,[t("div",Ta,[e[98]||(e[98]=t("h2",null,[t("b",null,"Snapshot")],-1)),i(be,{"in-label":"Name","model-value":Ie.value,"onUpdate:modelValue":e[26]||(e[26]=l=>Ie.value=l),"in-type":"text"},null,8,["model-value"]),i(be,{"in-label":"Description","model-value":Ue.value,"onUpdate:modelValue":e[27]||(e[27]=l=>Ue.value=l),"in-type":"text"},null,8,["model-value"]),t("div",Ea,[i(L,{onClick:It,style:{width:"fit-content"},"bt-disabled":!1},{default:C(()=>[i(u,{icon:"save"}),e[96]||(e[96]=m(" Create "))]),_:1}),i(L,{onClick:jt,style:{width:"fit-content"},"bt-disabled":!1},{default:C(()=>e[97]||(e[97]=[m("Cancel ")])),_:1})])])])):P("",!0),Be.value?(o(),n("div",Aa,[t("div",Na,[t("button",Va,[i(u,{icon:"times"})]),e[100]||(e[100]=t("h4",null,[t("b",null,"Playback Chart Option")],-1)),i(be,{"in-label":"Y Axis Max","in-type":"number","model-value":E.value,"onUpdate:modelValue":e[28]||(e[28]=l=>E.value=l)},null,8,["model-value"]),i(L,{"bt-size":"normal",onClick:e[29]||(e[29]=l=>Be.value=!Be.value),"bt-type":"button","bt-disabled":!1,style:{width:"fit-content"}},{default:C(()=>e[99]||(e[99]=[m("Apply")])),_:1})])])):P("",!0),Ce.value?(o(),n("button",{key:9,type:"button",onClick:e[30]||(e[30]=l=>Ce.value=!Ce.value),class:"predict-action-show"},[i(u,{icon:"eye"})])):P("",!0),Ce.value?P("",!0):(o(),n("button",{key:10,type:"button",onClick:Gt,class:"chart-resize"},[i(u,{icon:"left-right"})])),t("button",{type:"button",onClick:e[31]||(e[31]=l=>Be.value=!Be.value),class:"chart-options"},[i(u,{icon:"gear"})]),Le.value?(o(),n("div",za,[t("div",Ra,[t("button",{type:"button",class:"pred-option-dismiss",onClick:e[32]||(e[32]=l=>Le.value=!Le.value)},[i(u,{icon:"times"})]),e[106]||(e[106]=t("h3",null,[t("b",null,"Prediction")],-1)),i(xe,{"in-label":"Select Action","model-value":at.value,"onUpdate:modelValue":e[33]||(e[33]=l=>at.value=l)},{default:C(()=>e[101]||(e[101]=[t("option",{value:"predict"},"Predict with Selected Model",-1),t("option",{value:"predict_all"},"Predict with All Available Models",-1)])),_:1},8,["model-value"]),at.value=="predict"?(o(),n("p",Fa,[i(u,{icon:"info-circle"}),e[102]||(e[102]=m(" Predict using ")),t("b",null,k(q.value),1),e[103]||(e[103]=m(" model"))])):(o(),n("p",ja,[i(u,{icon:"info-circle"}),e[104]||(e[104]=m(" Predict using all avaliable models"))])),i(L,{onClick:Jt,style:{width:"fit-content"},"bt-disabled":!1},{default:C(()=>e[105]||(e[105]=[m("Start Prediction")])),_:1})])])):P("",!0),vt.value?(o(),oe(Sl,{key:12,onClose:e[34]||(e[34]=l=>vt.value=!1),"prediction-data":Dt.value},null,8,["prediction-data"])):P("",!0)],64)}}}),Ua=rt(Ia,[["__scopeId","data-v-88f5baf1"]]),Ba={class:"dateselect-window"},qa={class:"dateselect-inner"},Ka={class:"calendar-navigation"},Wa={style:{"font-size":"19px"}},Ha={class:"calendar-days"},Ga=["onClick"],Ja={key:0,style:{color:"orange","font-weight":"bold"}},Qa={key:1},Xa={style:{"margin-top":"1rem",display:"flex","flex-flow":"row nowrap","justify-content":"space-between"}},Za={style:{display:"flex","flex-flow":"row nowrap",gap:"0.3rem"}},eo=Ge({__name:"DateSelectView",props:{calendarTitle:{type:String,default:"Select Dates"},initialDates:{type:Array,default:()=>[]}},emits:["onApply","onClose"],setup(le,{emit:j}){const D=c(F().format("YYYY-MM-DD")),N=c([]),Y=j,$=le;W(()=>N.value,d=>{N.value=d.sort((s,f)=>new Date(s).getTime()-new Date(f).getTime())},{deep:!0});const r=()=>{Y("onApply",N.value)};return it(()=>{$.initialDates.length&&(N.value=$.initialDates)}),(d,s)=>{const f=Te("font-awesome-icon");return o(),n("div",Ba,[t("div",qa,[t("h4",null,[t("b",null,[i(f,{icon:"calendar"}),m(" "+k($.calendarTitle),1)])]),s[8]||(s[8]=t("hr",null,null,-1)),t("div",Ka,[t("button",{class:"navmonth-btn",onClick:s[0]||(s[0]=h=>D.value=w(F)(D.value).subtract(1,"month").format("YYYY-MM-DD"))},[i(f,{icon:"angle-left"}),m(" "+k(w(F)(D.value).subtract(1,"month").format("MMMM")),1)]),t("h3",Wa,[t("b",null,k(w(F)(D.value).format("MMMM YYYY")),1)]),t("button",{class:"navmonth-btn",onClick:s[1]||(s[1]=h=>D.value=w(F)(D.value).add(1,"month").format("YYYY-MM-DD"))},[m(k(w(F)(D.value).add(1,"month").format("MMMM"))+" ",1),i(f,{icon:"angle-right"})])]),s[9]||(s[9]=Xt('<div class="calendar-days" data-v-0be19428><div class="calendar-day-week" data-v-0be19428>Sen</div><div class="calendar-day-week" data-v-0be19428>Sel</div><div class="calendar-day-week" data-v-0be19428>Rab</div><div class="calendar-day-week" data-v-0be19428>Kam</div><div class="calendar-day-week" data-v-0be19428>Jum</div><div class="calendar-day-week" data-v-0be19428>Sab</div><div class="calendar-day-week" data-v-0be19428>Min</div></div>',1)),t("div",Ha,[(o(!0),n(R,null,K(w(F)(D.value).startOf("month").day(),h=>(o(),n("div",{key:h,class:"calendar-day-unclickable"}))),128)),(o(!0),n(R,null,K(w(F)(D.value).daysInMonth(),h=>(o(),n("div",{key:h,class:"calendar-day",onClick:O=>N.value.includes(w(F)(D.value).date(h).format("YYYY-MM-DD"))?N.value.splice(N.value.indexOf(w(F)(D.value).date(h).format("YYYY-MM-DD")),1):N.value.push(w(F)(D.value).date(h).format("YYYY-MM-DD")),style:Q({background:N.value.includes(w(F)(D.value).date(h).format("YYYY-MM-DD"))?"#aaaaaa":"#f0f0f0"})},[w(F)(D.value).date(h).format("YYYY-MM-DD")==w(F)().format("YYYY-MM-DD")?(o(),n("span",Ja,[m(k(h)+" ",1),s[4]||(s[4]=t("b",{style:{"font-size":"7px"}},"TODAY",-1))])):(o(),n("span",Qa,k(h),1))],12,Ga))),128)),(o(!0),n(R,null,K(6-w(F)(D.value).endOf("month").day(),h=>(o(),n("div",{key:h,class:"calendar-day-unclickable"}))),128))]),t("div",Xa,[i(L,{onClick:r,"bt-disabled":!N.value.length},{default:C(()=>s[5]||(s[5]=[m("Apply Selections")])),_:1},8,["bt-disabled"]),t("div",Za,[N.value.length?(o(),oe(L,{key:0,style:{background:"red"},onClick:s[2]||(s[2]=h=>N.value=[]),"bt-disabled":!1},{default:C(()=>[i(f,{icon:"trash"}),s[6]||(s[6]=m(" Clear"))]),_:1})):P("",!0),i(L,{onClick:s[3]||(s[3]=h=>Y("onClose")),"bt-disabled":!1},{default:C(()=>[i(f,{icon:"times"}),s[7]||(s[7]=m(" Close"))]),_:1})])])])])}}}),to=rt(eo,[["__scopeId","data-v-0be19428"]]),lo={class:"row"},ao={class:"col-md-3"},oo=["value"],so={style:{display:"flex","flex-flow":"row nowrap","align-items":"center",gap:"1rem"}},no={style:{display:"flex","flex-flow":"row nowrap",gap:"1rem","align-items":"center"}},io={class:"col-md-12",style:{position:"relative"}},ro={key:0,class:"loaders"},uo={key:0,class:"load-window"},po={class:"load-inner"},co={style:{display:"flex","flex-flow":"column","align-items":"flex-start",gap:"0.2rem"}},vo={style:{margin:"0",padding:"0"}},fo={style:{"font-size":"9px",color:"red"}},mo={style:{"font-size":"11px","margin-bottom":"1rem"}},yo={style:{display:"flex","flex-flow":"row wrap","font-size":"11px",gap:"0.2rem",border:"1px solid #ccc",width:"100%",padding:"10px","border-radius":"10px"}},bo={style:{color:"#555",padding:"5px",background:"#ddd","border-radius":"5px"}},go={style:{display:"flex","flex-flow":"row wrap","font-size":"11px",gap:"0.2rem",border:"1px solid #ccc",width:"100%",padding:"10px","border-radius":"10px"}},ko={style:{color:"#555",padding:"10px",background:"#eee","border-radius":"5px","text-align":"center"}},ho={style:{display:"flex","flex-flow":"row wrap","font-size":"12px",background:"#eee",padding:"10px","border-radius":"10px",border:"1px solid #ccc",width:"100%"}},wo={style:{"margin-right":"10px","font-weight":"bold"}},xo={style:{"font-weight":"bold"}},Do={style:{"font-weight":"bold"}},Mo={style:{"font-weight":"bold"}},So={style:{display:"flex","flex-flow":"row nowrap",gap:"0.3rem"}},Co={key:1,style:{display:"flex","flex-flow":"column","align-items":"center","justify-content":"center",gap:"1rem"}},$o={style:{"font-size":"30px"}},_o=Ge({__name:"PlaybackFol",setup(le){const j=ft(),D=St();D.asideToggle(!1);const N=c(j.getAllTrunk()),Y=c("trunk1"),$=c();$.value=Object.keys(N.value);const r=c(5),d=c(),s=c([]),f=c(0),h=c([]),O=c(!1),E=c(!1),g=c(!1),A=c(!0),p=c({}),I=$t();c([]);const V=()=>{f.value++,s.value.push(null)};mt(()=>{const x=I.params.saveid;x?setTimeout(async()=>{const v="https://rtunode.findingoillosses.com/api/v1/getpresetbyid",T={key:x},M=await He.post(v,T),U=M.data.status,B=M.data.data;if(U===200){const X=B;h.value=[],s.value=[];const G=X.dates;f.value=0,r.value=X.timerange,d.value=G[0];for(let Se=1;Se<G.length;Se++)V();setTimeout(()=>{document.querySelectorAll('input[type="date"]').forEach((Se,Ne)=>{Se.value=G[Ne],s.value[Ne]=Se}),se(),p.value={name:X.name,desc:X.desc,selectedMethod:X.selectedMethod,selectedModel:X.selectedModel,selection:X.selections,seekerValue:X.seekerValue},O.value=!0},100)}else D.notifyShowError("Failed fetching snapshot!")},1e3):(ge(),O.value=!0)}),W(()=>[d.value,r.value,Y.value],async()=>{p.value={},E.value=!0,await se()});const ge=()=>{const x=new Date,v=x.getFullYear(),T=String(x.getMonth()+1).padStart(2,"0"),M=String(x.getDate()).padStart(2,"0"),U=`${v}-${T}-${M}`;d.value=U},ue=async x=>new Promise(async(v,T)=>{try{const M=N.value[Y.value];let U=[];for(let G=0;G<M.spot.length;G++)U.push(M.spot[G].id);const B={datefilter:x,timeFilter:r.value,idFilter:U},X=await He.post(Zt.baseEnd+"api/History/getsplittedhistdata",B);v(X.data)}catch(M){T(M)}}),se=async()=>{try{g.value=!0;let v=[...await ue(d.value)];if(s.value.length>0){for(let T=0;T<s.value.length;T++){const M=s.value[T];if(M!==null){if(M.value!==d.value){const U=await ue(M.value);v=v.concat(U)}}else console.log("Null")}E.value=!1}h.value=v,g.value=!1}catch(x){console.log(x),E.value=!1,g.value=!1}},de=async()=>new Promise(async(x,v)=>{try{g.value=!0;let M=[...await ue(d.value)];if(s.value.length>0){for(let U=0;U<s.value.length;U++){const B=s.value[U];if(B!==null){if(B.value!==d.value){const X=await ue(B.value);M=M.concat(X)}}else console.log("Null")}E.value=!1}h.value=M,g.value=!1,x(!0)}catch(T){console.log(T),E.value=!1,g.value=!1,v(!1)}}),pe=(x,v)=>{s.value[v]=x,se()},$e=()=>{f.value>0&&(f.value--,s.value.pop()),se()},ce=x=>{d.value=x},ve=c([]),ut=async x=>{_e();const v={};v.name=x.name,v.desc=x.desc,v.timerange=r.value,v.selectedModel=x.selectedModel,v.selectedMethod=x.selectedMethod,v.dates=ve.value,v.selections=x.selections,v.seekerValue=x.seekerValue,v.context="jamerfol",(await He.post("https://rtunode.findingoillosses.com/api/v1/savepreset",v)).data.status===200?(D.notifyShow("Preset has been saved!"),ve.value=[]):(D.notifyShowError("Failed saving preset!"),ve.value=[])},_e=()=>{if(ve.value.push(d.value),s.value.length)for(let x in s.value)ve.value.push(s.value[x].value)},ke=c([]),H=c(!1),ne=()=>{H.value=!0,z()},z=async()=>{const x={context:"jamerfol"},v=await He.post("https://rtunode.findingoillosses.com/api/v1/getpresets",x);v.data.status===200?ke.value=v.data.data:D.notifyShowError("Failed fetching snapshots!")},De=async x=>{A.value=!1,h.value=null,s.value=[];const v=x.dates;f.value=0,r.value=x.timerange,d.value=v[0];for(let T=1;T<v.length;T++)V();Me(v).then(async()=>{await de().then(()=>{p.value={name:x.name,desc:x.desc,selectedMethod:x.selectedMethod,selectedModel:x.selectedModel,selection:x.selections,seekerValue:x.seekerValue},H.value=!1,setTimeout(()=>{A.value=!0},1e3)})})},Me=x=>new Promise((v,T)=>{try{setTimeout(()=>{document.querySelectorAll('input[type="date"]').forEach((M,U)=>{M.value=x[U],s.value[U]=M}),v(!0)},50)}catch(M){T(M)}}),he=x=>{const v=`https://jamer.findingoillosses.com/fol/playback/${x.key}`;navigator.clipboard.writeText(v).then(()=>{D.notifyShow(`${x.name} -> Link copied. CTRL+V to paste`)}),H.value=!1},Z=c(!1),Pe=c([]),te=x=>{Pe.value=x,Z.value=!1,d.value=x[0],s.value=[],f.value=0;for(let v=1;v<x.length;v++)V();setTimeout(()=>{document.querySelectorAll('input[type="date"]').forEach((v,T)=>{v.value=x[T],s.value[T]=v}),se()},100)},Ee=()=>{s.value=[],Pe.value=[],f.value=0,se()},Ae=()=>{Z.value=!1};return(x,v)=>{const T=Te("font-awesome-icon");return o(),n(R,null,[i(Qt,{"context-title":"Playback"},{default:C(()=>[t("div",lo,[t("div",ao,[i(xe,{"in-label":"Select Line","model-value":Y.value,"onUpdate:modelValue":v[0]||(v[0]=M=>Y.value=M)},{default:C(()=>[(o(!0),n(R,null,K($.value,(M,U)=>(o(),n("option",{key:U,value:M},k(N.value[M].name),9,oo))),128))]),_:1},8,["model-value"]),i(xe,{"in-label":"Time Range","model-value":r.value,"onUpdate:modelValue":v[1]||(v[1]=M=>r.value=M)},{default:C(()=>v[6]||(v[6]=[t("option",{value:"1"},"1 Menit",-1),t("option",{value:"2"},"2 Menit",-1),t("option",{value:"3"},"3 Menit",-1),t("option",{value:"4"},"4 Menit",-1),t("option",{value:"5"},"5 Menit",-1),t("option",{value:"10"},"10 Menit",-1),t("option",{value:"15"},"15 Menit",-1),t("option",{value:"30"},"30 Menit",-1),t("option",{value:"60"},"60 Menit",-1)])),_:1},8,["model-value"]),t("div",so,[i(be,{"in-type":"date","in-label":"Date Filter","model-value":d.value,"onUpdate:modelValue":v[2]||(v[2]=M=>d.value=M),style:{width:"100%"}},null,8,["model-value"])]),t("div",no,[i(L,{onClick:$e,"bt-size":"small","bt-type":"button","bt-disabled":!1},{default:C(()=>[i(T,{icon:"minus"})]),_:1}),t("span",{class:ie([`${w(D).textTheme}`])},k(f.value),3),i(L,{onClick:V,"bt-size":"small","bt-type":"button","bt-disabled":!1},{default:C(()=>[i(T,{icon:"plus"})]),_:1})]),(o(!0),n(R,null,K(f.value,(M,U)=>(o(),n("div",{key:U,style:{display:"flex","flex-flow":"row nowrap","align-items":"center",gap:"1rem"}},[i(be,{"in-type":"date","in-label":`Date Filter ${M}`,onOnValueChange:B=>pe(B,U),style:{width:"100%"}},null,8,["in-label","onOnValueChange"])]))),128)),i(L,{"bt-size":"normal","bt-type":"button",onClick:v[3]||(v[3]=M=>Z.value=!Z.value),"bt-disabled":!1,style:{"margin-top":"0.5rem",width:"fit-content"}},{default:C(()=>[i(T,{icon:"calendar"}),v[7]||(v[7]=m(" Select Dates "))]),_:1}),s.value.length>0?(o(),oe(L,{key:0,"bt-size":"normal","bt-type":"button",onClick:Ee,"bt-disabled":!1,style:{"margin-top":"0.5rem","margin-left":"5px",width:"fit-content",background:"red"}},{default:C(()=>[i(T,{icon:"trash"}),v[8]||(v[8]=m(" Clear Dates "))]),_:1})):P("",!0)]),t("div",io,[g.value&&O.value?(o(),n("div",ro,v[9]||(v[9]=[t("img",{src:"https://cdn.dribbble.com/users/1138184/screenshots/3796132/oil.gif",style:{width:"350px",height:"350px","object-fit":"contain","border-radius":"20px"}},null,-1)]))):P("",!0),h.value&&A.value?(o(),oe(Ua,{key:1,"snap-shots":p.value,"selected-dates":Pe.value,onOnDataSave:ut,onOnLoadPreset:ne,"init-date-filter":d.value,"selected-spot":Y.value,"init-playback-datas":h.value,onOnDateChange:ce},null,8,["snap-shots","selected-dates","init-date-filter","selected-spot","init-playback-datas"])):P("",!0)])])]),_:1}),H.value?(o(),n("div",uo,[t("div",po,[t("button",{type:"button",class:"load-dismiss",onClick:v[4]||(v[4]=M=>H.value=!H.value)},[i(T,{icon:"times"})]),ke.value.length>0?(o(),n(R,{key:0},[v[15]||(v[15]=t("h2",{style:{"padding-left":"1rem"}},[t("b",null,"Saved Snapshots")],-1)),(o(!0),n(R,null,K(ke.value,(M,U)=>(o(),n("div",{class:"preset-item",key:U},[t("div",co,[t("h5",vo,[t("b",null,[m(k(M.name)+" ",1),t("sup",fo,[t("b",null,"#"+k(M.key),1)])])]),t("div",mo,[v[10]||(v[10]=m("Description: ")),t("b",null,k(M.desc),1)]),t("div",yo,[(o(!0),n(R,null,K(M.dates,(B,X)=>(o(),n("div",{key:X,style:{"font-weight":"bold"}},[t("div",bo,[t("b",null,[i(T,{icon:"calendar"}),m(" "+k(B),1)])])]))),128))]),t("div",go,[(o(!0),n(R,null,K(M.selections,(B,X)=>(o(),n("div",{key:X,style:{"font-weight":"bold",width:"150px"}},[t("div",ko,[t("b",{style:Q({color:`${B.type=="drop"?"red":"green"}`})},k(`${B.name}: (${B.timerange})`),5)])]))),128))]),t("div",ho,[t("span",wo,[v[11]||(v[11]=m("Pick: ")),t("code",xo,k(M.selectedModel),1)]),t("span",Do,[v[12]||(v[12]=m("Prediction: ")),t("code",Mo,k(M.selectedMethod),1)])]),t("div",So,[i(L,{"bt-disabled":!1,"bt-size":"small","bt-type":"button",onClick:B=>De(M),style:{"margin-top":"1rem"}},{default:C(()=>[i(T,{icon:"plus"}),m(" Import "+k(M.name),1)]),_:2},1032,["onClick"]),i(L,{"bt-disabled":!1,"bt-size":"small","bt-type":"button",onClick:B=>he(M),style:{"margin-top":"1rem"}},{default:C(()=>[i(T,{icon:"copy"}),v[13]||(v[13]=m(" Copy Share Link "))]),_:2},1032,["onClick"]),i(L,{"bt-disabled":!1,"bt-size":"small","bt-type":"button",onClick:v[5]||(v[5]=B=>H.value=!H.value),style:{"margin-top":"1rem",background:"red"}},{default:C(()=>[i(T,{icon:"trash"}),v[14]||(v[14]=m(" Delete "))]),_:1})])])]))),128))],64)):(o(),n("div",Co,[t("span",$o,[i(T,{icon:"inbox"})]),v[16]||(v[16]=t("h5",{style:{padding:"0",margin:"0"}},"No Snapshot(s) Found!",-1)),v[17]||(v[17]=t("p",{style:{padding:"0",margin:"0","text-align":"center"}},[m("To add a new Snapshot, select Normal & Drop(s) on active Leak Detection chart and click "),t("b",null,"Create Snapshot")],-1))]))])])):P("",!0),Z.value?(o(),oe(to,{key:1,"initial-dates":Pe.value,onOnClose:Ae,onOnApply:te},null,8,["initial-dates"])):P("",!0)],64)}}}),Fo=rt(_o,[["__scopeId","data-v-fee4ceb3"]]);export{Fo as default};
