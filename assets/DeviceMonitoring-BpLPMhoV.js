import{_ as H}from"./MainWrapperView.vue_vue_type_style_index_0_lang-QwV3bJRF.js";import{u as U}from"./theme-DWwm_sKp.js";import{_ as z}from"./SelectView.vue_vue_type_style_index_0_lang-CoKcgxCf.js";import{t as F}from"./trunk-DoavT4Nh.js";import{d as C,h as s,i as V,m as A,j as $,L as R,k as Y,r as B,o as f,c as y,e as t,t as n,a as v,p,u as N,w as S,_ as j,b as G,y as E,F as L}from"./index-BQMU2KUN.js";import{a as P}from"./axios-BimPEqV4.js";import{i as q}from"./index-CehbAW_K.js";import{h}from"./moment-C5S46NFB.js";import{_ as K}from"./InputView.vue_vue_type_style_index_0_lang-DYnzODJi.js";const J={class:"dev-wrapper"},Q={class:"device-reading"},W={style:{"margin-top":"1.5rem"},class:"info-sums"},X={style:{"text-align":"left"}},Z={style:{"padding-left":"5px"}},ee={key:0,style:{"text-align":"right"}},te={style:{color:"green","font-weight":"bold"}},ae={key:1,style:{"text-align":"right"}},le={style:{color:"orange","font-weight":"bold"}},se={key:2,style:{"text-align":"right"}},oe={style:{color:"red","font-weight":"bold"}},ne={style:{"margin-top":"2rem",width:"100%","box-sizing":"border-box"}},ie=C({__name:"DeviceInfo",props:{idSpot:{type:Object,required:!0},spotData:{type:Object,required:!0}},setup(k){const i=s(""),b=s(null),d=s(null),o=s({title:{text:"Battery Stats",subtext:"Battery percentage over time",left:"center"},tooltip:{trigger:"axis",axisPointer:{type:"cross"}},xAxis:{type:"category",axisLine:{lineStyle:{color:"#8392A5"}},axisLabel:{rotate:45,formatter:function(l){return h(l).format("HH:mm")}},data:[]},yAxis:{type:"value",axisLine:{lineStyle:{color:"#8392A5"}},axisLabel:{formatter:"{value}%"}},series:[{data:[],type:"line",smooth:!0}]}),r=s({}),g=s(null),x=s(null),m=s(20),D=s(4),I=s(360),u=s(!1),_=k;V(()=>{M(),d.value=q(b.value),d.value.setOption(o.value),i.value=h().format("YYYY-MM-DD")}),window.addEventListener("resize",()=>{d.value&&d.value.resize()}),g.value=setInterval(()=>{M()},D.value*1e3),x.value=setInterval(()=>{T().then(l=>{o.value.xAxis.data=l.timestamp,o.value.series[0].data=l.batt,d.value.setOption(o.value)}).catch(l=>{console.log(l)})},I.value*1e3);const M=async()=>new Promise(async(l,e)=>{try{const a={id:_.idSpot+""},w=(await P.post(A.baseEnd+"api/Device/getdevicedata",a)).data;r.value=w}catch(a){e(a)}}),c=()=>{const l=h(r.value.time);let a=h().diff(l,"seconds");return a<0&&(a=0),a>60?(u.value=!0,{active:a<m.value,diff:Math.floor(a/60),diffType:"minutes"}):a>3600?(u.value=!0,{active:a<m.value,diff:Math.floor(a/3600),diffType:"minutes"}):(u.value=!0,{active:a<m.value,diff:a,diffType:"seconds"})};$(()=>{clearInterval(g.value),clearInterval(x.value),g.value=null,x.value=null}),R(async()=>{d.value&&await T().then(l=>{o.value.xAxis.data=l.timestamp,o.value.series[0].data=l.batt,d.value.setOption(o.value)}).catch(l=>{console.log(l)})});const T=()=>new Promise(async(l,e)=>{try{const a={id:_.idSpot+"",date:i.value},w=(await P.post(A.baseEnd+"api/Battery/getstats",a)).data;l(w)}catch(a){e(a)}});return Y(()=>i.value,()=>{T().then(l=>{o.value.xAxis.data=l.timestamp,o.value.series[0].data=l.batt,d.value.setOption(o.value)}).catch(l=>{console.log(l)})}),(l,e)=>{const a=B("font-awesome-icon"),O=B("center");return f(),y("div",J,[t("h5",null,[t("b",null,n(_.spotData.name),1)]),e[12]||(e[12]=t("img",{src:"https://cdn-icons-png.flaticon.com/512/11330/11330463.png",style:{"margin-top":"1rem",width:"80px",height:"80px","object-fit":"cover","border-radius":"100px"}},null,-1)),t("div",Q,[t("div",null,[t("label",null,[v(a,{icon:"gauge"})]),t("span",null,n(r.value.pressure)+" PSI",1)]),t("div",null,[t("label",null,[v(a,{icon:"car-battery"})]),t("span",null,n(r.value.battery)+"%",1)]),t("div",null,[t("label",null,[v(a,{icon:"wifi"})]),t("span",null,n(r.value.signal),1)])]),t("div",W,[t("div",X,[e[2]||(e[2]=t("label",null,"Last Update ",-1)),t("span",Z,[p(n(N(h)(r.value.time).fromNow()),1),e[1]||(e[1]=t("br",null,null,-1)),p(n(N(h)(r.value.time).format("( ddd, DD MMM YY HH:mm:ss )")),1)])]),t("div",null,[c().active&&c().diff<10?(f(),y("div",ee,[v(a,{icon:"circle",style:{color:"green"}}),e[5]||(e[5]=p()),t("span",te,[e[3]||(e[3]=p("Device Active ")),e[4]||(e[4]=t("br",null,null,-1)),p("("+n(c().diff)+" "+n(c().diffType)+" response gap)",1)])])):c().active&&c().diff>=m.value/2?(f(),y("div",ae,[v(a,{icon:"circle",style:{color:"orange"}}),e[8]||(e[8]=p()),t("span",le,[e[6]||(e[6]=p("Device Active ")),e[7]||(e[7]=t("br",null,null,-1)),p("("+n(c().diff)+" "+n(c().diffType)+" response gap - slow)",1)])])):(f(),y("div",se,[v(a,{icon:"circle",style:{color:"red"}}),e[9]||(e[9]=p()),t("span",oe,"Trouble reading... ("+n(c().diff)+")",1)]))])]),t("div",ne,[e[10]||(e[10]=t("hr",null,null,-1)),v(O,null,{default:S(()=>[v(K,{"model-value":i.value,"onUpdate:modelValue":e[0]||(e[0]=w=>i.value=w),style:{width:"200px"},"in-label":"Date","in-type":"date"},null,8,["model-value"])]),_:1}),e[11]||(e[11]=t("hr",null,null,-1)),t("div",{ref_key:"batChart",ref:b,style:{width:"100%",height:"300px"}},null,512)])])}}}),re=j(ie,[["__scopeId","data-v-f901700e"]]),ue={class:"col-md-3"},de=["value"],ve={class:"device-display"},ce=C({__name:"DeviceMonitoring",setup(k){const i=s(null),b=s(!1),d=s(1e3),o=U(),r=s(F().getAllTrunk()),g=s("trunk1"),x=s(Object.keys(r.value)),m=s([]);return o.asideToggle(!0),V(()=>{b.value=!0}),Y(()=>b.value,D=>{D?(console.log("MONITORING STARTED"),i.value=setInterval(()=>{},d.value)):(console.log("MONITORING STOPPED"),clearInterval(i.value))}),$(()=>{b.value=!1,i.value&&(clearInterval(i.value),i.value=null),console.log("MONITORING STOPPED")}),R(()=>{x.value&&(m.value=r.value[g.value].spot,console.log(m.value))}),(D,I)=>(f(),G(H,{"context-title":"Device Monitoring"},{default:S(()=>[t("div",ue,[v(z,{"in-label":"Installed Device","model-value":g.value,"onUpdate:modelValue":I[0]||(I[0]=u=>g.value=u)},{default:S(()=>[(f(!0),y(L,null,E(x.value,(u,_)=>(f(),y("option",{key:_,value:u},n(r.value[u].name),9,de))),128))]),_:1},8,["model-value"])]),t("div",ve,[(f(!0),y(L,null,E(m.value,(u,_)=>(f(),y("div",{class:"device-items",key:_},[v(re,{idSpot:u.id,"spot-data":u},null,8,["idSpot","spot-data"])]))),128))])]),_:1}))}}),we=j(ce,[["__scopeId","data-v-710f48bc"]]);export{we as default};
