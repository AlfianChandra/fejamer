import{_ as K}from"./MainWrapperView.vue_vue_type_style_index_0_lang-B78x-tN2.js";import{u as J}from"./theme-BVCUHpYa.js";import{_ as Q}from"./SelectView.vue_vue_type_style_index_0_lang-W55kNZez.js";import{t as W}from"./trunk-DoavT4Nh.js";import{d as $,h as s,i as G,m as B,j as Y,L as j,k as U,r as C,o as f,c as m,e as t,t as n,a as v,p,u as N,w as k,_ as F,b as X,y as E,F as z}from"./index-BH7i_2A5.js";import{a as H}from"./axios-BimPEqV4.js";import{i as V}from"./index-CehbAW_K.js";import{h as g}from"./moment-C5S46NFB.js";import{_ as Z}from"./InputView.vue_vue_type_style_index_0_lang-B0LO-Fyn.js";const ee={class:"dev-wrapper"},te={class:"device-reading"},ae={style:{"margin-top":"1.5rem"},class:"info-sums"},oe={style:{"text-align":"left"}},se={style:{"padding-left":"5px"}},le={key:0,style:{"text-align":"right"}},ne={style:{color:"green","font-weight":"bold"}},ie={key:1,style:{"text-align":"right"}},re={style:{color:"orange","font-weight":"bold"}},ue={key:2,style:{"text-align":"right"}},de={style:{color:"red","font-weight":"bold"}},ce={style:{"margin-top":"2rem",width:"100%","box-sizing":"border-box"}},ve={style:{"margin-top":"2rem",width:"100%","box-sizing":"border-box"}},pe=$({__name:"DeviceInfo",props:{idSpot:{type:Object,required:!0},spotData:{type:Object,required:!0}},setup(M){const i=s(""),x=s(null),S=s(null),_=s(null),u=s(null),d=s({title:{text:"Battery Stats",subtext:"Battery percentage over time",left:"center"},tooltip:{trigger:"axis",axisPointer:{type:"cross"}},legend:{data:["Battery Percentage","Pressure"],bottom:"0"},xAxis:[{type:"category",axisLine:{lineStyle:{color:"#8392A5"}},axisLabel:{rotate:45,formatter:function(a){return g(a).format("HH:mm")}},data:[]},{type:"category",axisLine:{lineStyle:{color:"#8392A5"}},axisLabel:{rotate:45,formatter:function(a){}},data:[]}],yAxis:[{name:"Pressure",nameLocation:"middle",nameGap:38,type:"value",position:"left",axisLine:{lineStyle:{color:"#8392A5"}},interval:25,max:300,axisLabel:{formatter:"{value}"}},{name:"Battery Percentage",nameLocation:"middle",nameGap:38,type:"value",position:"right",axisLine:{lineStyle:{color:"#8392A5"}},interval:10,axisLabel:{formatter:"{value}%"}}],series:[{name:"Pressure",data:[],type:"line",symbol:"none",smooth:!1,yAxisIndex:0,endLabel:{fontSize:9,color:"inherit",show:!0,distance:-50,offset:[0,-20],formatter:function(a){return a.value+" PSI"}}},{name:"Battery Percentage",data:[],type:"line",smooth:!1,symbol:"none",yAxisIndex:1,endLabel:{fontSize:9,color:"inherit",show:!0,distance:-30,offset:[0,-10],distacne:-5,formatter:function(a){return a.value+"%"}},itemStyle:{color:"#f00"}}]}),y=s({title:{text:"Device Response",subtext:"Device response over time (Higher is slower)",left:"center"},tooltip:{trigger:"axis",axisPointer:{type:"cross"}},legend:{data:["Response Time"],bottom:"0"},xAxis:{type:"category",axisLine:{lineStyle:{color:"#8392A5"}},axisLabel:{rotate:45},data:[]},yAxis:{name:"Response Time",nameLocation:"middle",nameGap:38,type:"value",position:"left",axisLine:{lineStyle:{color:"#8392A5"}},interval:25,max:50,axisLabel:{formatter:"{value}"}},series:[{name:"Response Time",data:[],type:"line",symbol:"none",smooth:!1,sampling:"average",endLabel:{fontSize:9,color:"inherit",show:!0,distance:0,offset:[0,-10],formatter:function(a){return a.value+" Sec"}}}]}),r=s({}),b=s(null),h=s(null),l=s(20),w=s(4),q=s(4),L=s(!1),I=s({time:[],response:[]}),T=M;G(()=>{R(),u.value=V(x.value),u.value.setOption(d.value),_.value=V(S.value),_.value.setOption(y.value),i.value=g().format("YYYY-MM-DD")}),window.addEventListener("resize",()=>{u.value&&u.value.resize()}),b.value=setInterval(()=>{R()},w.value*1e3),h.value=setInterval(()=>{A().then(a=>{P(a)}).catch(a=>{console.log(a)})},q.value*1e3);const R=async()=>new Promise(async(a,e)=>{try{const o={id:T.idSpot+""},D=(await H.post(B.baseEnd+"api/Device/getdevicedata",o)).data;r.value=D,I.value.time.push(g().format("HH:mm:ss")),I.value.response.push(c().diff),y.value.xAxis.data=I.value.time,y.value.series[0].data=I.value.response,_.value.setOption(y.value)}catch(o){e(o)}}),c=()=>{const a=g(r.value.time);let o=g().diff(a,"seconds");return o<0&&(o=0),o>60?(L.value=!0,{active:o<l.value,diff:Math.floor(o/60),diffType:"minutes"}):o>3600?(L.value=!0,{active:o<l.value,diff:Math.floor(o/3600),diffType:"minutes"}):(L.value=!0,{active:o<l.value,diff:o,diffType:"seconds"})};Y(()=>{clearInterval(b.value),clearInterval(h.value),b.value=null,h.value=null}),j(async()=>{u.value&&A().then(a=>{P(a)}).catch(a=>{console.log(a)})});const A=()=>new Promise(async(a,e)=>{try{const o={id:T.idSpot+"",date:i.value},D=(await H.post(B.baseEnd+"api/Battery/getstats",o)).data;a(D)}catch(o){e(o)}});U(()=>i.value,()=>{A().then(a=>{P(a)}).catch(a=>{console.log(a)})});const P=a=>{const e=a.battPayload,o=a.pressPayload;d.value.xAxis[0].data=o.pressureTime,d.value.xAxis[1].data=e.timestamp,d.value.series[0].data=o.pressure,d.value.series[1].data=e.batt,u.value.setOption(d.value)};return(a,e)=>{const o=C("font-awesome-icon"),O=C("center");return f(),m("div",ee,[t("h5",null,[t("b",null,n(T.spotData.name),1)]),e[13]||(e[13]=t("img",{src:"https://cdn-icons-png.flaticon.com/512/11330/11330463.png",style:{"margin-top":"1rem",width:"150px",height:"150px","object-fit":"cover","border-radius":"100px"}},null,-1)),t("div",te,[t("div",null,[t("label",null,[v(o,{icon:"gauge"})]),t("span",null,n(r.value.pressure)+" PSI",1)]),t("div",null,[t("label",null,[v(o,{icon:"car-battery"})]),t("span",null,n(r.value.battery)+"%",1)]),t("div",null,[t("label",null,[v(o,{icon:"wifi"})]),t("span",null,n(r.value.signal),1)])]),t("div",ae,[t("div",oe,[e[2]||(e[2]=t("label",null,"Last Update ",-1)),t("span",se,[p(n(N(g)(r.value.time).fromNow()),1),e[1]||(e[1]=t("br",null,null,-1)),p(n(N(g)(r.value.time).format("( ddd, DD MMM YY HH:mm:ss )")),1)])]),t("div",null,[c().active&&c().diff<10?(f(),m("div",le,[v(o,{icon:"circle",style:{color:"green"}}),e[5]||(e[5]=p()),t("span",ne,[e[3]||(e[3]=p("Device Active ")),e[4]||(e[4]=t("br",null,null,-1)),p("("+n(c().diff)+" "+n(c().diffType)+" response gap)",1)])])):c().active&&c().diff>=l.value/2?(f(),m("div",ie,[v(o,{icon:"circle",style:{color:"orange"}}),e[8]||(e[8]=p()),t("span",re,[e[6]||(e[6]=p("Device Active ")),e[7]||(e[7]=t("br",null,null,-1)),p("("+n(c().diff)+" "+n(c().diffType)+" response gap - slow)",1)])])):(f(),m("div",ue,[v(o,{icon:"circle",style:{color:"red"}}),e[9]||(e[9]=p()),t("span",de,"Trouble reading... ("+n(c().diff)+")",1)]))])]),t("div",ce,[e[10]||(e[10]=t("hr",null,null,-1)),v(O,null,{default:k(()=>[v(Z,{"model-value":i.value,"onUpdate:modelValue":e[0]||(e[0]=D=>i.value=D),style:{width:"200px"},"in-label":"Date","in-type":"date"},null,8,["model-value"])]),_:1}),e[11]||(e[11]=t("hr",null,null,-1)),t("div",{ref_key:"batChart",ref:x,style:{width:"100%",height:"500px"}},null,512)]),t("div",ve,[e[12]||(e[12]=t("hr",null,null,-1)),t("div",{ref_key:"devResponseChart",ref:S,style:{width:"100%",height:"350px"}},null,512)])])}}}),fe=F(pe,[["__scopeId","data-v-1d5516f9"]]),me={class:"col-md-3"},ye=["value"],ge={class:"device-display"},xe=$({__name:"DeviceMonitoring",setup(M){const i=s(null),x=s(!1),S=s(1e3),_=J(),u=s(W().getAllTrunk()),d=s("trunk1"),y=s(Object.keys(u.value)),r=s([]);return _.asideToggle(!0),G(()=>{x.value=!0}),U(()=>x.value,b=>{b?(console.log("MONITORING STARTED"),i.value=setInterval(()=>{},S.value)):(console.log("MONITORING STOPPED"),clearInterval(i.value))}),Y(()=>{x.value=!1,i.value&&(clearInterval(i.value),i.value=null),console.log("MONITORING STOPPED")}),j(()=>{y.value&&(r.value=u.value[d.value].spot,console.log(r.value))}),(b,h)=>(f(),X(K,{"context-title":"Device Monitoring"},{default:k(()=>[t("div",me,[v(Q,{"in-label":"Installed Device","model-value":d.value,"onUpdate:modelValue":h[0]||(h[0]=l=>d.value=l)},{default:k(()=>[(f(!0),m(z,null,E(y.value,(l,w)=>(f(),m("option",{key:w,value:l},n(u.value[l].name),9,ye))),128))]),_:1},8,["model-value"])]),t("div",ge,[(f(!0),m(z,null,E(r.value,(l,w)=>(f(),m("div",{class:"device-items",key:w},[v(fe,{idSpot:l.id,"spot-data":l},null,8,["idSpot","spot-data"])]))),128))])]),_:1}))}}),Ae=F(xe,[["__scopeId","data-v-710f48bc"]]);export{Ae as default};
