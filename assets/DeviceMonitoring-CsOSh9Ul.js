import{_ as q}from"./MainWrapperView.vue_vue_type_style_index_0_lang-B0DQ3YJe.js";import{u as J}from"./theme-CeV3WcFa.js";import{_ as K}from"./SelectView.vue_vue_type_style_index_0_lang-4spSDlWx.js";import{t as Q}from"./trunk-DoavT4Nh.js";import{u as B}from"./http-DTEixrf9.js";import{i as C}from"./index-CehbAW_K.js";import{h as g}from"./moment-C5S46NFB.js";import{_ as X}from"./InputView.vue_vue_type_style_index_0_lang-Ck-f13HL.js";import{d as $,N as s,P as E,Q as G,X as Y,R as j,r as N,o as f,c as m,e as t,t as n,a as v,T as p,u as H,w as k,_ as U,b as W,J as z,F as V}from"./index-B4zVKsCp.js";const Z={class:"dev-wrapper"},ee={class:"device-reading"},te={style:{"margin-top":"1.5rem"},class:"info-sums"},ae={style:{"text-align":"left"}},oe={style:{"padding-left":"5px"}},se={key:0,style:{"text-align":"right"}},le={style:{color:"green","font-weight":"bold"}},ne={key:1,style:{"text-align":"right"}},ie={style:{color:"orange","font-weight":"bold"}},re={key:2,style:{"text-align":"right"}},ue={style:{color:"red","font-weight":"bold"}},de={style:{"margin-top":"2rem",width:"100%","box-sizing":"border-box"}},ce={style:{"margin-top":"2rem",width:"100%","box-sizing":"border-box"}},ve=$({__name:"DeviceInfo",props:{idSpot:{type:Object,required:!0},spotData:{type:Object,required:!0}},setup(R){const i=s(""),x=s(null),S=s(null),_=s(null),u=s(null),d=s({title:{text:"Battery Stats",subtext:"Battery percentage over time",left:"center"},tooltip:{trigger:"axis",axisPointer:{type:"cross"}},legend:{data:["Battery Percentage","Pressure"],bottom:"0"},xAxis:[{type:"category",axisLine:{lineStyle:{color:"#8392A5"}},axisLabel:{rotate:45,formatter:function(a){return g(a).format("HH:mm")}},data:[]},{type:"category",axisLine:{lineStyle:{color:"#8392A5"}},axisLabel:{rotate:45,formatter:function(a){}},data:[]}],yAxis:[{name:"Pressure",nameLocation:"middle",nameGap:38,type:"value",position:"left",axisLine:{lineStyle:{color:"#8392A5"}},interval:25,max:300,axisLabel:{formatter:"{value}"}},{name:"Battery Percentage",nameLocation:"middle",nameGap:38,type:"value",position:"right",axisLine:{lineStyle:{color:"#8392A5"}},interval:10,axisLabel:{formatter:"{value}%"}}],series:[{name:"Pressure",data:[],type:"line",symbol:"none",smooth:!1,yAxisIndex:0,endLabel:{fontSize:9,color:"inherit",show:!0,distance:-50,offset:[0,-20],formatter:function(a){return a.value+" PSI"}}},{name:"Battery Percentage",data:[],type:"line",smooth:!1,symbol:"none",yAxisIndex:1,endLabel:{fontSize:9,color:"inherit",show:!0,distance:-30,offset:[0,-10],distacne:-5,formatter:function(a){return a.value+"%"}},itemStyle:{color:"#f00"}}]}),y=s({title:{text:"Device Response",subtext:"Device response over time (Higher is slower)",left:"center"},tooltip:{trigger:"axis",axisPointer:{type:"cross"}},legend:{data:["Response Time"],bottom:"0"},xAxis:{type:"category",axisLine:{lineStyle:{color:"#8392A5"}},axisLabel:{rotate:45},data:[]},yAxis:{name:"Response Time",nameLocation:"middle",nameGap:38,type:"value",position:"left",axisLine:{lineStyle:{color:"#8392A5"}},interval:25,axisLabel:{formatter:"{value}"}},series:[{name:"Response Time",data:[],type:"line",symbol:"none",smooth:!0,sampling:"average",endLabel:{fontSize:9,color:"inherit",show:!0,distance:0,offset:[0,-10],formatter:function(a){return a.value+" Sec"}}}]}),r=s({}),b=s(null),h=s(null),l=s(20),w=s(2),F=s(8),P=s(!1),I=s({time:[],response:[]}),T=R;E(()=>{M(),u.value=C(x.value),u.value.setOption(d.value),_.value=C(S.value),_.value.setOption(y.value),i.value=g().format("YYYY-MM-DD")}),window.addEventListener("resize",()=>{u.value&&u.value.resize()}),b.value=setInterval(()=>{M()},w.value*1e3),h.value=setInterval(()=>{A().then(a=>{L(a)}).catch(a=>{console.log(a)})},F.value*1e3);const M=async()=>new Promise(async(a,e)=>{try{const o={id:T.idSpot+""},D=await B().httpPost("api/Device/getdevicedata",o);r.value=D,I.value.time.push(g().format("HH:mm:ss")),I.value.response.push(c().diff),y.value.xAxis.data=I.value.time,y.value.series[0].data=I.value.response,_.value.setOption(y.value)}catch(o){e(o)}}),c=()=>{const a=g(r.value.time);let o=g().diff(a,"seconds");return o<0&&(o=0),o>60?(P.value=!0,{active:o<l.value,diff:Math.floor(o/60),diffType:"minutes"}):o>3600?(P.value=!0,{active:o<l.value,diff:Math.floor(o/3600),diffType:"minutes"}):(P.value=!0,{active:o<l.value,diff:o,diffType:"seconds"})};G(()=>{clearInterval(b.value),clearInterval(h.value),b.value=null,h.value=null}),Y(async()=>{u.value&&A().then(a=>{L(a)}).catch(a=>{console.log(a)})});const A=()=>new Promise(async(a,e)=>{try{const o={id:T.idSpot+"",date:i.value},D=await B().httpPost("api/Battery/getstats",o);a(D)}catch(o){e(o)}});j(()=>i.value,()=>{A().then(a=>{L(a)}).catch(a=>{console.log(a)})});const L=a=>{const e=a.battPayload,o=a.pressPayload;d.value.xAxis[0].data=o.pressureTime,d.value.xAxis[1].data=e.timestamp,d.value.series[0].data=o.pressure,d.value.series[1].data=e.batt,u.value.setOption(d.value)};return(a,e)=>{const o=N("font-awesome-icon"),O=N("center");return f(),m("div",Z,[t("h5",null,[t("b",null,n(T.spotData.name),1)]),e[13]||(e[13]=t("img",{src:"https://cdn-icons-png.flaticon.com/512/11330/11330463.png",style:{"margin-top":"1rem",width:"150px",height:"150px","object-fit":"cover","border-radius":"100px"}},null,-1)),t("div",ee,[t("div",null,[t("label",null,[v(o,{icon:"gauge"})]),t("span",null,n(r.value.pressure)+" PSI",1)]),t("div",null,[t("label",null,[v(o,{icon:"car-battery"})]),t("span",null,n(r.value.battery)+"%",1)]),t("div",null,[t("label",null,[v(o,{icon:"wifi"})]),t("span",null,n(r.value.signal),1)])]),t("div",te,[t("div",ae,[e[2]||(e[2]=t("label",null,"Last Update ",-1)),t("span",oe,[p(n(H(g)(r.value.time).fromNow()),1),e[1]||(e[1]=t("br",null,null,-1)),p(n(H(g)(r.value.time).format("( ddd, DD MMM YY HH:mm:ss )")),1)])]),t("div",null,[c().active&&c().diff<10?(f(),m("div",se,[v(o,{icon:"circle",style:{color:"green"}}),e[5]||(e[5]=p()),t("span",le,[e[3]||(e[3]=p("Device Active ")),e[4]||(e[4]=t("br",null,null,-1)),p("("+n(c().diff)+" "+n(c().diffType)+" response gap)",1)])])):c().active&&c().diff>=l.value/2?(f(),m("div",ne,[v(o,{icon:"circle",style:{color:"orange"}}),e[8]||(e[8]=p()),t("span",ie,[e[6]||(e[6]=p("Device Active ")),e[7]||(e[7]=t("br",null,null,-1)),p("("+n(c().diff)+" "+n(c().diffType)+" response gap - slow)",1)])])):(f(),m("div",re,[v(o,{icon:"circle",style:{color:"red"}}),e[9]||(e[9]=p()),t("span",ue,"Trouble reading... ("+n(c().diff)+")",1)]))])]),t("div",de,[e[10]||(e[10]=t("hr",null,null,-1)),v(O,null,{default:k(()=>[v(X,{"model-value":i.value,"onUpdate:modelValue":e[0]||(e[0]=D=>i.value=D),style:{width:"200px"},"in-label":"Date","in-type":"date"},null,8,["model-value"])]),_:1}),e[11]||(e[11]=t("hr",null,null,-1)),t("div",{ref_key:"batChart",ref:x,style:{width:"100%",height:"500px"}},null,512)]),t("div",ce,[e[12]||(e[12]=t("hr",null,null,-1)),t("div",{ref_key:"devResponseChart",ref:S,style:{width:"100%",height:"350px"}},null,512)])])}}}),pe=U(ve,[["__scopeId","data-v-b229b12f"]]),fe={class:"col-md-3"},me=["value"],ye={class:"device-display"},ge=$({__name:"DeviceMonitoring",setup(R){const i=s(null),x=s(!1),S=s(1e3),_=J(),u=s(Q().getAllTrunk()),d=s("trunk1"),y=s(Object.keys(u.value)),r=s([]);return _.asideToggle(!0),E(()=>{x.value=!0}),j(()=>x.value,b=>{b?(console.log("MONITORING STARTED"),i.value=setInterval(()=>{},S.value)):(console.log("MONITORING STOPPED"),clearInterval(i.value))}),G(()=>{x.value=!1,i.value&&(clearInterval(i.value),i.value=null),console.log("MONITORING STOPPED")}),Y(()=>{y.value&&(r.value=u.value[d.value].spot,console.log(r.value))}),(b,h)=>(f(),W(q,{"context-title":"Device Monitoring"},{default:k(()=>[t("div",fe,[v(K,{"in-label":"Installed Device","model-value":d.value,"onUpdate:modelValue":h[0]||(h[0]=l=>d.value=l)},{default:k(()=>[(f(!0),m(V,null,z(y.value,(l,w)=>(f(),m("option",{key:w,value:l},n(u.value[l].name),9,me))),128))]),_:1},8,["model-value"])]),t("div",ye,[(f(!0),m(V,null,z(r.value,(l,w)=>(f(),m("div",{class:"device-items",key:w},[v(pe,{idSpot:l.id,"spot-data":l},null,8,["idSpot","spot-data"])]))),128))])]),_:1}))}}),Te=U(ge,[["__scopeId","data-v-529d9729"]]);export{Te as default};
