import{_ as G}from"./MainWrapperView.vue_vue_type_style_index_0_lang-Coe7vQhw.js";import{u as H}from"./theme-B2SkGQAG.js";import{_ as U}from"./SelectView.vue_vue_type_style_index_0_lang-bDb-Mwl6.js";import{t as F}from"./trunk-DoavT4Nh.js";import{d as V,h as l,i as $,m as M,j as R,L as Y,k as j,r as O,o as v,c as y,e as t,t as n,a as u,p as c,u as B,w as A,_ as z,b as q,y as N,F as E}from"./index-BC2mPBti.js";import{a as C}from"./axios-BimPEqV4.js";import{i as K}from"./index-CehbAW_K.js";import{h}from"./moment-C5S46NFB.js";import{_ as J}from"./InputView.vue_vue_type_style_index_0_lang-Do8iL7T7.js";const Q={class:"dev-wrapper"},W={class:"device-reading"},X={style:{"margin-top":"1.5rem"},class:"info-sums"},Z={style:{"text-align":"left"}},ee={style:{"padding-left":"5px"}},te={key:0,style:{"text-align":"right"}},ae={style:{color:"green","font-weight":"bold"}},oe={key:1,style:{"text-align":"right"}},le={style:{color:"orange","font-weight":"bold"}},ne={key:2,style:{"text-align":"right"}},se={style:{color:"red","font-weight":"bold"}},ie={style:{"margin-top":"2rem",width:"100%","box-sizing":"border-box"}},re=V({__name:"DeviceInfo",props:{idSpot:{type:Object,required:!0},spotData:{type:Object,required:!0}},setup(L){const s=l(""),x=l(null),p=l(null),f=l({title:{text:"Battery Stats",subtext:"Battery percentage over time",left:"center"},tooltip:{trigger:"axis",axisPointer:{type:"cross"}},legend:{data:["Battery Percentage","Pressure"],bottom:"0"},xAxis:[{type:"category",axisLine:{lineStyle:{color:"#8392A5"}},axisLabel:{rotate:45,formatter:function(o){return h(o).format("HH:mm")}},data:[]},{type:"category",axisLine:{lineStyle:{color:"#8392A5"}},axisLabel:{rotate:45,formatter:function(o){}},data:[]}],yAxis:[{name:"Pressure",nameLocation:"middle",nameGap:42,type:"value",position:"left",axisLine:{lineStyle:{color:"#8392A5"}},interval:25,max:300,axisLabel:{formatter:"{value}"}},{name:"Battery Percentage",nameLocation:"middle",nameGap:42,type:"value",position:"right",axisLine:{lineStyle:{color:"#8392A5"}},interval:10,axisLabel:{formatter:"{value}%"}}],series:[{name:"Pressure",data:[],type:"line",symbol:"none",smooth:!1,yAxisIndex:0,sampling:"average",endLabel:{fontSize:9,color:"inherit",show:!0,distance:-50,offset:[0,-10],formatter:function(o){return o.value+" PSI"}}},{name:"Battery Percentage",data:[],type:"line",smooth:!1,symbol:"none",yAxisIndex:1,endLabel:{fontSize:9,color:"inherit",show:!0,distance:-30,offset:[0,-10],distacne:-5,formatter:function(o){return o.value+"%"}},itemStyle:{color:"#f00"}}]}),i=l({}),g=l(null),_=l(null),m=l(20),D=l(4),I=l(360),r=l(!1),b=L;$(()=>{k(),p.value=K(x.value),p.value.setOption(f.value),s.value=h().format("YYYY-MM-DD")}),window.addEventListener("resize",()=>{p.value&&p.value.resize()}),g.value=setInterval(()=>{k()},D.value*1e3),_.value=setInterval(()=>{S().then(o=>{P(o)}).catch(o=>{console.log(o)})},I.value*1e3);const k=async()=>new Promise(async(o,e)=>{try{const a={id:b.idSpot+""},w=(await C.post(M.baseEnd+"api/Device/getdevicedata",a)).data;i.value=w}catch(a){e(a)}}),d=()=>{const o=h(i.value.time);let a=h().diff(o,"seconds");return a<0&&(a=0),a>60?(r.value=!0,{active:a<m.value,diff:Math.floor(a/60),diffType:"minutes"}):a>3600?(r.value=!0,{active:a<m.value,diff:Math.floor(a/3600),diffType:"minutes"}):(r.value=!0,{active:a<m.value,diff:a,diffType:"seconds"})};R(()=>{clearInterval(g.value),clearInterval(_.value),g.value=null,_.value=null}),Y(async()=>{p.value&&S().then(o=>{P(o)}).catch(o=>{console.log(o)})});const S=()=>new Promise(async(o,e)=>{try{const a={id:b.idSpot+"",date:s.value},w=(await C.post(M.baseEnd+"api/Battery/getstats",a)).data;o(w)}catch(a){e(a)}});j(()=>s.value,()=>{S().then(o=>{P(o)}).catch(o=>{console.log(o)})});const P=o=>{const e=o.battPayload,a=o.pressPayload;f.value.xAxis[0].data=a.pressureTime,f.value.xAxis[1].data=e.timestamp,f.value.series[0].data=a.pressure,f.value.series[1].data=e.batt,p.value.setOption(f.value)};return(o,e)=>{const a=O("font-awesome-icon"),T=O("center");return v(),y("div",Q,[t("h5",null,[t("b",null,n(b.spotData.name),1)]),e[12]||(e[12]=t("img",{src:"https://cdn-icons-png.flaticon.com/512/11330/11330463.png",style:{"margin-top":"1rem",width:"80px",height:"80px","object-fit":"cover","border-radius":"100px"}},null,-1)),t("div",W,[t("div",null,[t("label",null,[u(a,{icon:"gauge"})]),t("span",null,n(i.value.pressure)+" PSI",1)]),t("div",null,[t("label",null,[u(a,{icon:"car-battery"})]),t("span",null,n(i.value.battery)+"%",1)]),t("div",null,[t("label",null,[u(a,{icon:"wifi"})]),t("span",null,n(i.value.signal),1)])]),t("div",X,[t("div",Z,[e[2]||(e[2]=t("label",null,"Last Update ",-1)),t("span",ee,[c(n(B(h)(i.value.time).fromNow()),1),e[1]||(e[1]=t("br",null,null,-1)),c(n(B(h)(i.value.time).format("( ddd, DD MMM YY HH:mm:ss )")),1)])]),t("div",null,[d().active&&d().diff<10?(v(),y("div",te,[u(a,{icon:"circle",style:{color:"green"}}),e[5]||(e[5]=c()),t("span",ae,[e[3]||(e[3]=c("Device Active ")),e[4]||(e[4]=t("br",null,null,-1)),c("("+n(d().diff)+" "+n(d().diffType)+" response gap)",1)])])):d().active&&d().diff>=m.value/2?(v(),y("div",oe,[u(a,{icon:"circle",style:{color:"orange"}}),e[8]||(e[8]=c()),t("span",le,[e[6]||(e[6]=c("Device Active ")),e[7]||(e[7]=t("br",null,null,-1)),c("("+n(d().diff)+" "+n(d().diffType)+" response gap - slow)",1)])])):(v(),y("div",ne,[u(a,{icon:"circle",style:{color:"red"}}),e[9]||(e[9]=c()),t("span",se,"Trouble reading... ("+n(d().diff)+")",1)]))])]),t("div",ie,[e[10]||(e[10]=t("hr",null,null,-1)),u(T,null,{default:A(()=>[u(J,{"model-value":s.value,"onUpdate:modelValue":e[0]||(e[0]=w=>s.value=w),style:{width:"200px"},"in-label":"Date","in-type":"date"},null,8,["model-value"])]),_:1}),e[11]||(e[11]=t("hr",null,null,-1)),t("div",{ref_key:"batChart",ref:x,style:{width:"100%",height:"390px"}},null,512)])])}}}),ue=z(re,[["__scopeId","data-v-d9f218ec"]]),de={class:"col-md-3"},ce=["value"],ve={class:"device-display"},pe=V({__name:"DeviceMonitoring",setup(L){const s=l(null),x=l(!1),p=l(1e3),f=H(),i=l(F().getAllTrunk()),g=l("trunk1"),_=l(Object.keys(i.value)),m=l([]);return f.asideToggle(!0),$(()=>{x.value=!0}),j(()=>x.value,D=>{D?(console.log("MONITORING STARTED"),s.value=setInterval(()=>{},p.value)):(console.log("MONITORING STOPPED"),clearInterval(s.value))}),R(()=>{x.value=!1,s.value&&(clearInterval(s.value),s.value=null),console.log("MONITORING STOPPED")}),Y(()=>{_.value&&(m.value=i.value[g.value].spot,console.log(m.value))}),(D,I)=>(v(),q(G,{"context-title":"Device Monitoring"},{default:A(()=>[t("div",de,[u(U,{"in-label":"Installed Device","model-value":g.value,"onUpdate:modelValue":I[0]||(I[0]=r=>g.value=r)},{default:A(()=>[(v(!0),y(E,null,N(_.value,(r,b)=>(v(),y("option",{key:b,value:r},n(i.value[r].name),9,ce))),128))]),_:1},8,["model-value"])]),t("div",ve,[(v(!0),y(E,null,N(m.value,(r,b)=>(v(),y("div",{class:"device-items",key:b},[u(ue,{idSpot:r.id,"spot-data":r},null,8,["idSpot","spot-data"])]))),128))])]),_:1}))}}),De=z(pe,[["__scopeId","data-v-710f48bc"]]);export{De as default};
